# Response

Dans un `Handler`, [`Response`](https://docs.rs/salvo_core/latest/salvo_core/http/response/struct.Response.html) est passée en tant que paramètre :
* La structure `Response` encapsule tous les composants d'une réponse HTTP et fournit une API complète pour construire et manipuler les réponses HTTP.
* Elle prend en charge un style d'appel chaîné (par exemple `res.status_code(200).body("Hello")`), facilitant la construction fluide des réponses.
* Ses fonctionnalités principales incluent :
    * Définir le code d'état et les en-têtes
    * Manipuler le corps de la réponse (prise en charge des chaînes de caractères, octets, fichiers et données en flux)
    * Gérer les Cookies
    * Plusieurs méthodes de rendu de contenu
* Cette structure utilise un modèle de référence mutable, renvoyant une référence à elle-même via `&mut self`, permettant ainsi aux gestionnaires de construire et personnaliser facilement les réponses HTTP pour répondre à divers besoins de services Web.

```rust
#[handler]
async fn hello_world(res: &mut Response) {
    res.render("Hello world!");
}
```

Après que le serveur reçoit une requête client, tout `Handler` et middleware correspondant peut écrire des données dans `Response`. Dans certains cas, par exemple si un middleware souhaite empêcher l'exécution des middlewares et `Handler` suivants, vous pouvez utiliser `FlowCtrl` :

```rust
#[handler]
async fn hello_world(res: &mut Response, ctrl: &mut FlowCtrl) {
    ctrl.skip_rest();
    res.render("Hello world!");
}
```

## Écrire du contenu

Écrire des données dans `Response` est très simple :

- Écrire des données en texte brut

    ```rust
    res.render("Hello world!");
    ```

- Écrire des données sérialisées en JSON

    ```rust
    use serde::Serialize;
    use salvo::prelude::Json;

    #[derive(Serialize, Debug)]
    struct User {
        name: String,
    }
    let user = User{name: "jobs".to_string()};
    res.render(Json(user));
    ```

:::warning
Si la méthode `render` est appelée plusieurs fois pour écrire des données JSON, ces données ne seront pas fusionnées en un seul objet JSON. Elles seront plutôt concaténées séquentiellement en tant que fragments de texte indépendants, ce qui pourrait entraîner un format JSON invalide. Si vous devez renvoyer plusieurs données, combinez-les d'abord en un seul objet avant de les sérialiser en une fois, ou gérez la logique vous-même.
:::


- Écrire du HTML
    
    ```rust
    res.render(Text::Html("<html><body>hello</body></html>"));
    ```

## Écrire une erreur HTTP


- Utiliser `render` permet d'écrire des informations d'erreur détaillées dans `Response`.

    ```rust
    use salvo::http::errors::*;
    res.render(StatusError::internal_server_error().brief("error when serialize object to json"))
    ```

- Si vous n'avez pas besoin de personnaliser le message d'erreur, vous pouvez directement appeler `set_http_code`.

    ```rust
    use salvo::http::StatusCode;
    res.status_code(StatusCode::BAD_REQUEST);
    ```

## Rediriger vers une autre URL
- La méthode `render` peut être utilisée pour écrire une réponse de redirection dans `Response`, naviguant vers une nouvelle URL. Lorsque vous appelez la méthode `Redirect::found`, elle définit le code d'état HTTP à 302 (Found), indiquant une redirection temporaire.
    ```rust
    use salvo::prelude::*;

    #[handler]
    async fn redirect(res: &mut Response) {
        res.render(Redirect::found("https://salvo.rs/"));
    }
    ```


## ResBody

Le type de Body renvoyé par Response est `ResBody`. C'est une énumération qui est définie sur `ResBody::Error` en cas d'erreur, contenant les informations d'erreur pour un traitement différé. `StatusError` n'implémente pas réellement `Writer`, dans le but de vous permettre de personnaliser votre propre méthode d'affichage dans `Catcher`.



# Aperçu des méthodes de la structure Response

| Catégorie | Méthode | Description |
|------|------|------|
| **Création** | `new()` / `with_cookies()` | Créer une nouvelle réponse |
| **Code d'état** | `status_code()` | Définir le code d'état |
| **En-têtes** | `headers()/headers_mut()` | Obtenir les en-têtes |
| | `set_headers()/add_header()` | Définir/ajouter un en-tête |
| | `content_type()` | Obtenir le type de contenu |
| **Version HTTP** | `version()/version_mut()` | Obtenir/modifier la version HTTP |
| **Corps de la réponse** | `body()/body_mut()` | Définir/obtenir le corps de la réponse |
| | `replace_body()/take_body()` | Remplacer/extraire le corps de la réponse |
| | `write_body()` | Écrire des données dans le corps de la réponse |
| | `stream()/channel()` | Réponse en flux/créer un canal d'envoi |
| **Gestion des Cookies** | `cookies()/cookie()` | Obtenir les cookies/un cookie spécifique |
| | `add_cookie()/remove_cookie()` | Ajouter/supprimer un cookie |
| **Réponse de contenu** | `render()` | Rendre le contenu |
| | `stuff()` | Définir le code d'état et rendre le contenu |
| | `send_file()` | Envoyer un fichier |
| **Requête d'état** | `is_stamped()` | Vérifier si la réponse est prête à être renvoyée |
{/* Auto generated, origin file hash:44c6af44c98679e79e0828f210a61cd0 */}