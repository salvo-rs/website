---
title: Librerie per la gestione degli errori in Rust
---

# Librerie per la gestione degli errori in Rust

- (thiserror)[https://docs.rs/thiserror/latest/thiserror/] fornisce macro derivate convenienti per tipi di errore personalizzati.

- (snafu)[https://docs.rs/snafu/latest/snafu/] è un framework per la gestione e segnalazione degli errori con contesto.

- (anyhow)[https://docs.rs/anyhow/latest/anyhow/] è una libreria flessibile per la gestione e segnalazione degli errori.

## thiserror vs snafu

### thiserror

thiserror è una libreria leggera che fornisce macro derivate per semplificare la definizione degli errori.

Caratteristiche:
- Sintassi concisa, bassa cerimonialità
- Adatta per creare librerie di tipi di errore e API
- Generalmente utilizzata per creare librerie destinate ad altri

```rust
use thiserror::Error;

#[derive(Error, Debug)]
pub enum DataError {
    #[error("Errore database: {0}")]
    DatabaseError(#[from] sqlx::Error),
    
    #[error("Errore validazione: {0}")]
    ValidationError(String),
    
    #[error("Record non trovato")]
    NotFound,
}
```

### snafu

snafu fornisce un framework di gestione errori più completo, concentrandosi sul contesto degli errori e sulla catena degli errori.

Caratteristiche:
- Promuove l'aggiunta di contesto agli errori in modo più preciso con il pattern "selettore di contesto"
- Raccomanda il pattern "un'enumerazione di errori per modulo"
- Supporta varianti di errore in stile struct e tuple
- Supporto integrato per backtrace

```rust
use snafu::{Snafu, ResultExt, Backtrace};

#[derive(Debug, Snafu)]
pub enum Error {
    #[snafu(display("Impossibile leggere il file di configurazione {filename:?}"))]
    ReadConfig {
        filename: String,
        source: std::io::Error,
        backtrace: Backtrace,
    },
    
    // È possibile utilizzare anche lo stile tuple
    #[snafu(display("Errore IO"))]
    Io(#[snafu(source)] std::io::Error, #[snafu(backtrace)] Backtrace),
}

// Esempio di selettore di contesto
fn read_config(path: &str) -> Result<Config, Error> {
    std::fs::read_to_string(path).context(ReadConfigSnafu { filename: path })?;
    // ...
}
```

### Confronto

| Caratteristica | thiserror | snafu |
|----------------|-----------|-------|
| Conciseness sintattica | Più conciso | Più prolisso |
| Contesto errori | Supporto base | Meccanismi di contesto ricchi |
| Scala adatta | Progetti piccoli/medi | Progetti medi/grandi |
| Righe di codice | ~2 righe per errore | ~5 righe per errore |
| Organizzazione errori | Solitamente un'enumerazione singola | Promuove enumerazioni per modulo |
| Supporto backtrace | Nessun supporto integrato | Supporto integrato |

**Consigli di scelta**:
- **Scegli thiserror** quando hai bisogno di tipi di errore semplici e chiari, specialmente nelle librerie
- **Scegli snafu** quando hai bisogno di una gestione errori più strutturata, specialmente in applicazioni grandi

## anyhow

anyhow è una libreria di gestione errori diversa dalle precedenti, focalizzata sulle applicazioni piuttosto che sulle librerie.

Caratteristiche:
- Progettata per la gestione errori nelle applicazioni, non nelle librerie
- Fornisce il tipo dinamico `anyhow::Error` che può contenere qualsiasi errore che implementi il trait `Error`
- Semplifica la gestione attraverso più tipi di errore
- Non richiede la definizione di tipi di errore personalizzati

```rust
use anyhow::{Context, Result};

fn main() -> Result<()> {
    let config = std::fs::read_to_string("config.json")
        .context("Impossibile leggere il file di configurazione")?;
        
    let app_config: AppConfig = serde_json::from_str(&config)
        .context("Formato configurazione non valido")?;
        
    // Utilizza Result<T> come alias di tipo per Result<T, anyhow::Error>
    Ok(())
}
```

**anyhow vs thiserror/snafu**:
- anyhow si concentra sulla gestione errori durante lo sviluppo rapido di applicazioni
- thiserror/snafu si concentrano sulla creazione di gerarchie precise di tipi di errore
- anyhow è tipicamente utilizzato nel codice applicativo
- thiserror/snafu sono tipicamente utilizzati nel codice di libreria

Nella pratica, anyhow e thiserror sono spesso usati insieme: le librerie utilizzano thiserror per definire tipi di errore precisi, mentre le applicazioni utilizzano anyhow per gestire errori provenienti da varie fonti.
{/* 本行由工具自动生成,原文哈希值:e786d782f2c0d052350def02a332c83f */}