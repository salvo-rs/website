# Защита от CSRF

## Что такое CSRF?

CSRF (Cross-Site Request Forgery, подделка межсайтовых запросов) — это уязвимость безопасности, при которой злоумышленник заставляет аутентифицированного пользователя выполнить нежелательные действия без его ведома. Проще говоря, атакующий использует авторизованную сессию пользователя для отправки вредоносных запросов от его имени.

## Принцип CSRF-атаки

Типичные этапы атаки:
1. Пользователь входит на целевой сайт A и получает аутентификационную cookie
2. Пользователь посещает вредоносный сайт B
3. Код на сайте B автоматически отправляет запрос к сайту A, используя cookie пользователя
4. Сайт A не может отличить вредоносный запрос от действий самого пользователя

## Стратегии защиты

Salvo предоставляет промежуточное ПО (middleware) для защиты вашего приложения от CSRF-атак:

- Добавление скрытого CSRF-токена в формы
- Проверка наличия валидного CSRF-токена в запросах пользователя
- По умолчанию проверяются POST, PATCH, DELETE и PUT запросы

## Реализация CSRF в Salvo

`Csrf` — это структура, реализующая трейт `Handler`, содержащая поле `skipper` для указания запросов, не требующих проверки. По умолчанию проверяются запросы `Method::POST`, `Method::PATCH`, `Method::DELETE` и `Method::PUT`.

Salvo поддерживает два способа хранения CSRF-токенов:

1. **CookieStore**: токен хранится в cookie, проверяется соответствие значения `csrf-token` из заголовка или формы со значением в cookie
2. **SessionStore**: токен хранится в сессии, требует совместного использования с middleware для работы с сессиями

_**Пример кода**_ (cookie store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Пример кода**_ (session store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* 本行由工具自动生成,原文哈希值:2eb072bb663695f226b56a34f14cdbb0 */}