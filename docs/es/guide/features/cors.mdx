# Control de Acceso entre Orígenes

CORS (Cross-Origin Resource Sharing, Intercambio de Recursos de Origen Cruzado) es un mecanismo que permite a los navegadores realizar solicitudes a servidores de diferentes orígenes, superando así las restricciones de la política del mismo origen del navegador.

## ¿Qué es la Política del Mismo Origen?

La política del mismo origen es una función de seguridad del navegador que limita cómo un documento o script cargado desde un origen puede interactuar con recursos de otro origen. Se considera "mismo origen" cuando comparten el mismo protocolo, dominio y número de puerto.

## ¿Por qué se necesita CORS?

Cuando una aplicación frontend necesita acceder a una API de un origen diferente, se requiere soporte CORS. Por ejemplo:
- La aplicación frontend está desplegada en `https://frontend.com`
- El servicio API está desplegado en `https://api.backend.com`

Sin CORS, el navegador impediría que la aplicación frontend acceda al servicio API.

## Cómo funciona CORS

CORS implementa el control de acceso entre orígenes a través de una serie de cabeceras HTTP:
- **Solicitud Simple**: Se envía directamente, y el servidor controla si se permite a través de las cabeceras de respuesta.
- **Solicitud de Preflight**: El navegador primero envía una solicitud OPTIONS para preguntar al servidor si permite el acceso entre orígenes. Una vez obtenido el permiso, envía la solicitud real.

Dado que el navegador envía una solicitud de preflight `Method::OPTIONS`, es necesario agregar manejo para este tipo de solicitudes. El middleware CORS debe añadirse al `Service`.

## Usando CORS en Salvo

Salvo proporciona un middleware CORS integrado que se puede configurar y usar fácilmente. A continuación se muestra un código de ejemplo:

:::warning
Nota: El middleware `.hoop(cors)` se aplica al `Service`. El middleware `.hoop(cors)` se aplica al `Service`. El middleware `.hoop(cors)` se aplica al `Service`, no al `Router`.
Esto permite manejar automáticamente la preflight OPTIONS.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:5800", "http://localhost:5800"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Configurar el enrutador del backend con protección CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Código de Ejemplo**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Opciones de Configuración Principales

El middleware CORS ofrece varias opciones de configuración:

- **Orígenes Permitidos**: Controla qué dominios pueden acceder a los recursos.
- **Métodos Permitidos**: Especifica los métodos HTTP permitidos (GET, POST, etc.).
- **Cabeceras Permitidas**: Especifica las cabeceras de solicitud permitidas.
- **Cabeceras Expuestas**: Especifica qué cabeceras de respuesta pueden ser accedidas por el cliente.
- **Permitir Credenciales**: Indica si se permiten credenciales como cookies en las solicitudes.
- **Tiempo de Caché para Preflight**: Duración del caché para los resultados de las solicitudes de preflight.

Mediante una configuración adecuada de CORS, se puede garantizar la seguridad al mismo tiempo que se satisfacen las necesidades de acceso entre orígenes.
{/* Auto generated, origin file hash:cf229c3c39be32658130e3590ea819e7 */}