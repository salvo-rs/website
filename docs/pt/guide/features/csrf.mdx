# Defesa CSRF

## O que é CSRF?

CSRF (Cross-Site Request Forgery, Falsificação de Solicitação Entre Sites) é uma vulnerabilidade de segurança cibernética em que um invasor induz um usuário autenticado a executar ações não intencionais sem seu conhecimento. Em termos simples, o invasor se aproveita da identidade logada do usuário para enviar solicitações maliciosas em seu nome.

## Princípio do Ataque CSRF

As etapas do ataque geralmente são as seguintes:
1. O usuário faz login no site alvo A e obtém um cookie de autenticação
2. O usuário visita o site malicioso B
3. O código no site malicioso B envia automaticamente uma solicitação para o site A, carregando o cookie do usuário
4. O site A não consegue distinguir se esta é uma solicitação maliciosa ou uma ação legítima do usuário

## Estratégias de Proteção

O Salvo fornece um middleware CSRF para proteger sua aplicação contra este tipo de ataque:

- Adiciona um token CSRF oculto em formulários
- Verifica se as solicitações enviadas pelos usuários contêm um token CSRF válido
- Por padrão, valida solicitações POST, PATCH, DELETE e PUT

## Implementação CSRF no Salvo

`Csrf` é uma estrutura que implementa `Handler`, contendo internamente um campo `skipper` que pode especificar quais solicitações devem ser ignoradas na verificação. Por padrão, valida solicitações `Method::POST`, `Method::PATCH`, `Method::DELETE` e `Method::PUT`.

O Salvo suporta dois métodos de armazenamento de tokens CSRF:

1. **CookieStore**: Armazena o token em um cookie, verificando se o `csrf-token` no cabeçalho ou formulário da solicitação corresponde ao valor do cookie
2. **SessionStore**: Armazena o token na sessão, exigindo uso conjunto com middleware de sessão

_**Código de Exemplo**_ (cookie store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Código de Exemplo**_ (session store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:2eb072bb663695f226b56a34f14cdbb0 */}