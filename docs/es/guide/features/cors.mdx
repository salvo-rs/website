# Control de Origen Cruzado

CORS (Intercambio de Recursos de Origen Cruzado) es un mecanismo que permite a los navegadores realizar solicitudes a servidores de origen cruzado, superando así las restricciones impuestas por la política de mismo origen del navegador.

## ¿Qué es la Política de Mismo Origen?

La política de mismo origen es una característica de seguridad de los navegadores que restringe cómo los documentos o scripts cargados desde un origen pueden interactuar con recursos de otro origen. "Mismo origen" se refiere a tener el mismo protocolo, dominio y número de puerto.

## ¿Por qué se Necesita CORS?

El soporte de CORS es necesario cuando una aplicación frontend necesita acceder a APIs de un origen diferente. Por ejemplo:
- La aplicación frontend está desplegada en `https://frontend.com`
- El servicio API está desplegado en `https://api.backend.com`

Sin CORS, el navegador impedirá que la aplicación frontend acceda al servicio API.

## Cómo Funciona CORS

CORS implementa el control de acceso de origen cruzado a través de una serie de encabezados HTTP:
- **Solicitudes Simples**: Se envían directamente, con el servidor controlando si se permite el acceso mediante encabezados de respuesta.
- **Solicitudes Preflight**: El navegador primero envía una solicitud OPTIONS para preguntar al servidor si se permite el acceso de origen cruzado, y solo envía la solicitud real después de recibir permiso.

Dado que el navegador envía solicitudes preflight con `Method::OPTIONS`, es necesario manejar dichas solicitudes. El middleware CORS debe agregarse al `Service`.

## Uso de CORS en Salvo

Salvo proporciona middleware CORS integrado que puede configurarse y usarse fácilmente. Aquí hay un fragmento de código de ejemplo:

:::warning
Nota: El middleware `.hoop(cors)` se aplica al `Service`, no al `Router`. Esto garantiza el manejo automático de las solicitudes preflight OPTIONS.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:8698", "http://localhost:8698"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Configurar el router del backend con protección CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Código de Ejemplo**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Opciones Principales de Configuración

El middleware CORS proporciona varias opciones de configuración:

- **Orígenes Permitidos**: Controla qué dominios pueden acceder a los recursos.
- **Métodos Permitidos**: Especifica los métodos HTTP permitidos (GET, POST, etc.).
- **Encabezados Permitidos**: Especifica los encabezados de solicitud permitidos.
- **Encabezados Expuestos**: Especifica qué encabezados de respuesta pueden ser accedidos por el cliente.
- **Permitir Credenciales**: Determina si las solicitudes pueden incluir credenciales como cookies.
- **Tiempo de Caché de Solicitud Preflight**: La duración del caché para los resultados de las solicitudes preflight.

Al configurar CORS adecuadamente, puedes garantizar tanto la seguridad como la capacidad de cumplir con los requisitos de acceso de origen cruzado.
{/* Auto generated, origin file hash:06a4a7b1ce4049ea7d3c15924bdd7397 */}