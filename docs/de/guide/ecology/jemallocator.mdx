---
title: Rust-Speicherallokator-Alternativen
---

# Jemallocator: Rust jemalloc Speicherallokator-Alternative

:::tip
Der Standardallokator gibt manchmal Speicher nicht rechtzeitig frei. Es wird empfohlen, (jemallocator)[https://docs.rs/tikv-jemallocator/latest/tikv_jemallocator/] als globalen Allokator anstelle des Standardallokators zu verwenden.
:::

(jemallocator)[https://docs.rs/tikv-jemallocator/latest/tikv_jemallocator/] ist eine Bibliothek, die mit dem jemalloc-Speicherallokator verknüpft ist. Sie stellt den `Jemalloc`-Unit-Typ bereit, der die Allokator-API implementiert und als `#[global_allocator]` festgelegt werden kann.

`tikv-jemallocator` ist der Nachfolger von `jemallocator`. Diese beiden Crates sind identisch, abgesehen von ihren Namen. Für neue Projekte wird die `tikv-xxx`-Version empfohlen.

## Das jemalloc-Ökosystem

Das jemalloc-Unterstützungsökosystem besteht aus folgenden Crates:

- **tikv-jemalloc-sys**: Baut jemalloc und verlinkt es, stellt die rohen C-Bindings dafür bereit.
- **tikv-jemallocator**: Stellt den `Jemalloc`-Typ bereit, der die `GlobalAlloc`- und `Alloc`-Traits implementiert.
- **tikv-jemalloc-ctl**: Eine hochwertige Abstraktion für die jemalloc-Steuerungs- und Introspections-API (die `mallctl*()`-Funktionsfamilie und `MALLCTL NAMESPACE`).

## Verwendung

### Abhängigkeiten hinzufügen

Um tikv-jemallocator zu verwenden, fügen Sie es als Abhängigkeit hinzu:

```toml
[dependencies]

[target.'cfg(not(target_env = "msvc"))'.dependencies]
tikv-jemallocator = "0.5"
```

### Als globalen Allokator festlegen

Um `tikv_jemallocator::Jemalloc` als globalen Allokator festzulegen, fügen Sie Ihrem Projekt folgenden Code hinzu:

```rust
#[cfg(not(target_env = "msvc"))]
use tikv_jemallocator::Jemalloc;

#[cfg(not(target_env = "msvc"))]
#[global_allocator]
static GLOBAL: Jemalloc = Jemalloc;
```

Das war's! Sobald diese statische Variable definiert ist, wird jemalloc für alle Speicherzuweisungen verwendet, die vom Rust-Code im selben Programm angefordert werden.

## Vorteile

jemalloc ist eine allgemeine malloc-Implementierung, die sich auf Folgendes konzentriert:

- Reduzierung von Speicherfragmentierung
- Skalierbarkeit unter hoher Nebenläufigkeit
- Bereitstellung umfangreicher Introspections- und Steuerungsmöglichkeiten

Besonders nützlich ist es in folgenden Szenarien:
- Lang laufende Anwendungen
- Speicherintensive Workloads
- Hochleistungsdienste, die eine feingranulare Speicherverwaltung erfordern

## Hinweise zur Kompatibilität

jemalloc unterstützt die MSVC-Zielumgebung nicht und ist daher unter Windows mit der MSVC-Toolchain nicht verfügbar. Deshalb sind in den Beispielcodes die Bedingungen `cfg(not(target_env = "msvc"))` enthalten.
{/* Auto generated, origin file hash:97d5bd2f5d44a1facae329972bdc937f */}