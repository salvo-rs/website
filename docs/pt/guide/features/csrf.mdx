# Proteção CSRF

## O que é CSRF?

CSRF (Cross-Site Request Forgery) é uma vulnerabilidade de segurança web em que atacantes enganam utilizadores autenticados para executar ações não intencionais sem o seu conhecimento. Em termos simples, os atacantes exploram o estado de login de um utilizador para enviar pedidos maliciosos em seu nome.

## Como Funcionam os Ataques CSRF

O processo típico de ataque envolve:
1. O utilizador faz login no website alvo A e obtém um cookie de autenticação.
2. O utilizador visita um website malicioso B.
3. O código no website malicioso B envia automaticamente um pedido para o website A, transportando o cookie do utilizador.
4. O website A não consegue distinguir se este é um pedido malicioso ou uma ação legítima do utilizador.

## Estratégias de Proteção

O Salvo fornece middleware CSRF para proteger as suas aplicações contra tais ataques:

- Adicionar um token CSRF oculto aos formulários.
- Verificar se os pedidos submetidos pelo utilizador contêm um token CSRF válido.
- Por padrão, validar pedidos POST, PATCH, DELETE e PUT.

## Implementação CSRF no Salvo

`Csrf` é uma estrutura que implementa a característica `Handler` e inclui um campo interno `skipper` para especificar pedidos que devem ignorar a validação. Por padrão, valida pedidos `Method::POST`, `Method::PATCH`, `Method::DELETE` e `Method::PUT`.

O Salvo suporta dois métodos de armazenamento de token CSRF:

1. **CookieStore**: Armazena o token num cookie e verifica se o `csrf-token` nos cabeçalhos do pedido ou formulário corresponde ao valor do cookie.
2. **SessionStore**: Armazena o token na sessão e requer o uso de middleware de sessão.

_**Código de Exemplo**_ (armazenamento em cookie)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Código de Exemplo**_ (armazenamento em sessão)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:281af9db9061b1bf9710319568d31c6d */}