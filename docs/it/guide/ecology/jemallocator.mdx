---
title: Alternative per l'allocatore di memoria in Rust
---

# Jemallocator: alternativa all'allocatore di memoria jemalloc per Rust

:::tip
L'allocatore predefinito può occasionalmente presentare ritardi nel rilascio della memoria. Si consiglia di utilizzare (jemallocator)[https://docs.rs/tikv-jemallocator/latest/tikv_jemallocator/] come allocatore globale in sostituzione di quello predefinito.
:::

(jemallocator)[https://docs.rs/tikv-jemallocator/latest/tikv_jemallocator/] è una libreria che si collega all'allocatore di memoria jemalloc, fornendo il tipo unitario `Jemalloc`. Questo tipo implementa l'API dell'allocatore e può essere impostato come `#[global_allocator]`.

`tikv-jemallocator` è il progetto successore di `jemallocator`. Le due crate sono identiche eccetto che per il nome. Per nuovi progetti, si raccomanda di utilizzare la versione `tikv-xxx`.

## Ecosistema jemalloc

L'ecosistema di supporto per jemalloc è composto dalle seguenti crate:

- **tikv-jemalloc-sys**: Compila e collega jemalloc, esponendo i binding C grezzi.
- **tikv-jemallocator**: Fornisce il tipo `Jemalloc` che implementa i tratti `GlobalAlloc` e `Alloc`.
- **tikv-jemalloc-ctl**: Wrapper di alto livello per le API di controllo e introspezione di jemalloc (la famiglia di funzioni `mallctl*()` e `MALLCTL NAMESPACE`).

## Utilizzo

### Aggiunta delle dipendenze

Per utilizzare tikv-jemallocator, aggiungilo come dipendenza:

```toml
[dependencies]

[target.'cfg(not(target_env = "msvc"))'.dependencies]
tikv-jemallocator = "0.5"
```

### Impostazione come allocatore globale

Per impostare `tikv_jemallocator::Jemalloc` come allocatore globale, aggiungi il seguente codice al tuo progetto:

```rust
#[cfg(not(target_env = "msvc"))]
use tikv_jemallocator::Jemalloc;

#[cfg(not(target_env = "msvc"))]
#[global_allocator]
static GLOBAL: Jemalloc = Jemalloc;
```

Fatto! Una volta definita questa variabile statica, jemalloc verrà utilizzato per tutte le allocazioni di memoria richieste dal codice Rust nello stesso programma.

## Vantaggi

jemalloc è un'implementazione generica di malloc che si concentra su:

- Riduzione della frammentazione della memoria
- Scalabilità in scenari ad alta concorrenza
- Fornitura di ricche capacità di introspezione e controllo

Particolarmente utile in scenari come:
- Applicazioni a esecuzione prolungata
- Carichi di lavoro intensivi per la memoria
- Servizi ad alte prestazioni che richiedono una gestione fine della memoria

## Note sulla compatibilità

jemalloc non supporta l'ambiente target MSVC, pertanto non è disponibile quando si utilizza la toolchain MSVC su Windows. Questo è il motivo per cui il codice di esempio include la condizione `cfg(not(target_env = "msvc"))`.
{/* 本行由工具自动生成,原文哈希值:97d5bd2f5d44a1facae329972bdc937f */}