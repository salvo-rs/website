# データベースの利用

### [Diesel](https://diesel.rs/)

```rust
use diesel::prelude::*;
use diesel::r2d2::{ConnectionManager, Pool, PoolError, PooledConnection};
use once_cell::sync::OnceCell;
use salvo::prelude::*;

const DB_URL: &str = "postgres://benchmarkdbuser:benchmarkdbpass@tfb-database/hello_world";
type PgPool = Pool<ConnectionManager<PgConnection>>;

static DB_POOL: OnceCell<PgPool> = OnceCell::new();

fn connect() -> Result<PooledConnection<ConnectionManager<PgConnection>>, PoolError> {
    DB_POOL.get().unwrap().get()
}
fn build_pool(database_url: &str, size: u32) -> Result<PgPool, PoolError> {
    let manager = ConnectionManager::<PgConnection>::new(database_url);
    diesel::r2d2::Pool::builder()
        .max_size(size)
        .min_idle(Some(size))
        .test_on_check_out(false)
        .idle_timeout(None)
        .max_lifetime(None)
        .build(manager)
}

fn main() {
    DB_POOL
        .set(build_pool(&DB_URL, 10).expect(&format!("Error connecting to {}", &DB_URL)))
        .ok();
}

#[handler]
async fn show_article(req: &mut Request, res: &mut Response) -> Result<(), Error> {
    let id: i64 = req.param::<i64>("id").unwrap_or_default();
    let conn = connect()?;
    let article = articles::table.find(id).first::<Article>(&conn)?;
    res.render(Json(row));
    Ok(())
}
```

### [Sqlx](https://github.com/launchbadge/sqlx)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
<Tab label="main.rs">
```rust file="<root>/codes/db-postgres-sqlx/src/main.rs"
```
</Tab>
<Tab label="Cargo.toml">
```toml file="<root>/codes/db-postgres-sqlx/Cargo.toml"
```
</Tab>
</Tabs>

### [rbatis](https://github.com/rbatis/rbatis)

<Tabs>
<Tab label="main.rs">
```rust file="<root>/codes/db-mysql-rbatis/src/main.rs"
```
</Tab>
<Tab label="Cargo.toml">
```toml file="<root>/codes/db-mysql-rbatis/Cargo.toml"
```
</Tab>
</Tabs>

## [SeaORM](https://www.sea-ql.org/SeaORM/)

SeaORMは非同期・動的型付けのORMで、エンティティ関係、マイグレーションシステム、完全な型安全クエリビルダーを含む強力なリレーショナルデータベースサポートを提供します。フル機能ORMを必要とする中規模から大規模プロジェクトに適しています。

## [Tokio ORM (Toasty)](https://github.com/tokio-rs/toasty)

ToastyはTokioチームによって開発されているORMで、現在も活発に開発が進められており、Tokioエコシステムと緊密に統合されたORMソリューションの提供に注力しています。Tokioに依存し、新興技術を採用する意欲のあるプロジェクトに適している可能性があります。

## [SurrealDB Rust SDK](https://surrealdb.com/docs/sdk/rust)

SurrealDBのRust SDKは、このマルチモデルデータベースとの接続機能を提供し、グラフデータ、ドキュメントデータ、リレーショナルデータを扱う必要があるアプリケーションに適しています。柔軟なデータモデルを必要とするプロジェクトにとって優れた選択肢です。
{/* Auto generated, origin file hash:bc23a03c686915fc88ee2cb8c32dfe63 */}