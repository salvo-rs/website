# CSRF Protection

## What is CSRF?

CSRF (Cross-Site Request Forgery) is a web security vulnerability where attackers trick authenticated users into performing unintended actions without their knowledge. In simple terms, attackers exploit a user's logged-in status to send malicious requests on their behalf.

## How CSRF Attacks Work

The typical attack process involves:
1. The user logs into the target website A and obtains an authentication cookie.
2. The user visits a malicious website B.
3. Code on malicious website B automatically sends a request to website A, carrying the user's cookie.
4. Website A cannot distinguish whether this is a malicious request or a legitimate user action.

## Protection Strategies

Salvo provides CSRF middleware to protect your applications from such attacks:

- Add a hidden CSRF token to forms.
- Verify that user-submitted requests contain a valid CSRF token.
- By default, validate POST, PATCH, DELETE, and PUT requests.

## CSRF Implementation in Salvo

`Csrf` is a struct that implements the `Handler` trait and includes an internal `skipper` field to specify requests that should skip validation. By default, it validates `Method::POST`, `Method::PATCH`, `Method::DELETE`, and `Method::PUT` requests.

Salvo supports two CSRF token storage methods:

1. **CookieStore**: Stores the token in a cookie and verifies whether the `csrf-token` in the request headers or form matches the cookie value.
2. **SessionStore**: Stores the token in the session and requires the use of session middleware.

_**Example Code**_ (cookie store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Example Code**_ (session store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* 本行由工具自动生成,原文哈希值:2eb072bb663695f226b56a34f14cdbb0 */}