# Towerミドルウェアとの互換性

import { Tab, Tabs } from '@rspress/core/theme';

Salvoは`tower-compat`機能を通じて、Towerエコシステムとの互換性サポートを提供します。詳細なAPIについては[ドキュメントを参照してください](https://docs.rs/salvo_extra/latest/salvo_extra/tower_compat/index.html)。

## Towerのコアコンセプト

Towerはサービス抽象化ライブラリで、主に2つのコアトレイトに基づいています：

### Serviceトレイト

```rust
pub trait Service<Request> {
    type Response;
    type Error;
    type Future: Future<Output = Result<Self::Response, Self::Error>>;

    fn poll_ready(&mut self, cx: &mut Context<'_>) -> Poll<Result<(), Self::Error>>;
    fn call(&mut self, req: Request) -> Self::Future;
}
```

`Service`はリクエストを処理してレスポンスを返す役割を担い、Salvoのハンドラーと類似しています。

### Layerトレイト

```rust
pub trait Layer<S> {
    type Service;
    fn layer(&self, inner: S) -> Self::Service;
}
```

`Layer`はサービスをラップして追加機能を提供するために使用され、Salvoのミドルウェアと類似しています。

## Salvoの互換性サポート

SalvoはTowerエコシステムとの互換性を実現するために、2つの重要なトレイト実装を提供します：

- **TowerLayerCompat**：Towerの`Layer`をSalvoの`Handler`に変換し、Hoop（ミドルウェア）として使用可能にします
- **TowerServiceCompat**：Towerの`Service`をSalvoの`Handler`に変換します

使用例：
```rust
// TowerのRateLimitLayerを使用し、compat()メソッドでSalvo互換形式に変換
let limit = RateLimitLayer::new(5, Duration::from_secs(30)).compat();
let router = Router::new().hoop(limit).get(hello);
```

_**サンプルコード**_

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/with-tower/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/with-tower/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:e4430fa65292b4543e3cd6f2010c4932 */}