# Compatibilidade com Middleware Tower

import { Tab, Tabs } from '@rspress/core/theme';

O Salvo fornece suporte de compatibilidade para o ecossistema Tower através do recurso `tower-compat`. Para detalhes da API, consulte a [documentação](https://docs.rs/salvo_extra/latest/salvo_extra/tower_compat/index.html).

## Conceitos Fundamentais do Tower

Tower é uma biblioteca de abstração de serviços baseada principalmente em dois traits centrais:

### Trait Service

```rust
pub trait Service<Request> {
    type Response;
    type Error;
    type Future: Future<Output = Result<Self::Response, Self::Error>>;

    fn poll_ready(&mut self, cx: &mut Context<'_>) -> Poll<Result<(), Self::Error>>;
    fn call(&mut self, req: Request) -> Self::Future;
}
```

O `Service` é responsável por processar requisições e retornar respostas, semelhante aos handlers do Salvo.

### Trait Layer

```rust
pub trait Layer<S> {
    type Service;
    fn layer(&self, inner: S) -> Self::Service;
}
```

O `Layer` é usado para encapsular serviços e adicionar funcionalidades extras, semelhante aos middlewares do Salvo.

## Suporte de Compatibilidade do Salvo

O Salvo fornece a implementação de dois traits-chave para compatibilidade com o ecossistema Tower:

- **TowerLayerCompat**: Converte um `Layer` do Tower em um `Handler` do Salvo, permitindo seu uso como Hoop (middleware)
- **TowerServiceCompat**: Converte um `Service` do Tower em um `Handler` do Salvo

Exemplo de uso:
```rust
// Usa o RateLimitLayer do Tower e converte para o formato compatível com Salvo usando o método compat()
let limit = RateLimitLayer::new(5, Duration::from_secs(30)).compat();
let router = Router::new().hoop(limit).get(hello);
```

_**Código de Exemplo**_

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/with-tower/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/with-tower/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:e4430fa65292b4543e3cd6f2010c4932 */}