# Depot

import { Tab, Tabs } from '@rspress/core/theme';

[Depot](https://docs.rs/salvo_core/latest/salvo_core/struct.Depot.html) es una estructura utilizada para almacenar datos temporales involucrados en una solicitud. Los middleware pueden colocar sus datos temporales procesados en el Depot para que los utilicen programas posteriores.

Cuando un servidor recibe una solicitud de un navegador cliente, crea una instancia de `Depot`. Esta instancia se destruirá después de que todos los middleware y `Handler` hayan procesado la solicitud.

Por ejemplo, podemos establecer `current_user` en el middleware de inicio de sesión y luego leer la información del usuario actual en middleware o `Handler` posteriores.

## Comprensión rápida

`Depot` se utiliza para almacenar y compartir datos durante el procesamiento de una solicitud. Implementa un contenedor de datos seguro en cuanto a tipos, que admite dos modos de uso principales:

1. **Almacenamiento clave-valor**: Acceder a valores asociados con claves de cadena mediante los métodos `insert`/`get`.
2. **Inyección de tipos**: Almacenar y recuperar valores basados en tipos mediante los métodos `inject`/`obtain`.

Como se muestra en el ejemplo, `Depot` es especialmente útil para pasar datos entre middleware y manejadores. Los middleware pueden establecer valores en `Depot` (como información de usuario, estado de autenticación), y los manejadores posteriores pueden obtener estos valores sin necesidad de repetir cálculos o consultas. El diseño de `Depot` garantiza la consistencia y accesibilidad de los datos en toda la cadena de procesamiento de solicitudes, siendo una herramienta central para construir aplicaciones web complejas.

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/use-depot/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/use-depot/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Establecer y recuperar datos mediante `insert` y `get`

Como se mostró anteriormente, se puede insertar `key` y `value` en `Depot` mediante `insert`. Para este tipo de valores, se recuperan directamente con `get`.

```rust
depot.insert("a", "b");
assert_eq!(depot.get::<&str>("a").copied().unwrap(), "b")
```

Si la `key` no existe, o si la `key` existe pero el tipo no coincide, se devuelve `None`.

## Establecer y recuperar datos mediante `inject` y `obtain`

A veces, existen casos en los que no es necesario relacionar una `key` específica, y para este tipo existe una única instancia. Se puede utilizar `inject` para insertar datos y luego `obtain` para recuperarlos. No requieren que proporciones una `key`.

```rust
depot.inject(Config::new());
depot.obtain::<Config>();
```

# Resumen de métodos de la estructura Depot

| Categoría | Método | Descripción |
|------|------|------|
| **Creación/Capacidad** | `new()` | Crea un Depot vacío |
| | `with_capacity(capacity)` | Crea un Depot con capacidad especificada |
| | `capacity()` | Obtiene la capacidad |
| | `inner()` | Obtiene referencia al HashMap interno |
| **Inyección/Obtención de tipos** | `inject<V>(value)` | Inyecta un valor por tipo |
| | `obtain<T>()` | Obtiene referencia al valor inyectado |
| | `obtain_mut<T>()` | Obtiene referencia mutable al valor inyectado |
| | `contains<T>()` | Verifica si contiene un tipo específico |
| | `scrape<T>()` | Elimina y devuelve el valor inyectado |
| **Operaciones clave-valor** | `insert(key, value)` | Inserta un par clave-valor |
| | `get<V>(key)` | Obtiene referencia al valor correspondiente a la clave |
| | `get_mut<V>(key)` | Obtiene referencia mutable al valor correspondiente a la clave |
| | `contains_key(key)` | Verifica si contiene una clave específica |
| | `remove<V>(key)` | Elimina la clave y devuelve el valor |
| | `delete(key)` | Elimina el par clave-valor |
{/* Auto generated, origin file hash:11bf72b48a504b8ce6ae390caf56080c */}