# Совместимость с Tower Middleware

import { Tab, Tabs } from '@rspress/core/theme';

Salvo обеспечивает поддержку совместимости с экосистемой Tower через функцию `tower-compat`. Для получения информации о конкретных API, пожалуйста, [обратитесь к документации](https://docs.rs/salvo_extra/latest/salvo_extra/tower_compat/index.html).

## Основные концепции Tower

Tower — это библиотека абстракций сервисов, основанная в первую очередь на двух основных трейтах:

### Трейт Service

```rust
pub trait Service<Request> {
    type Response;
    type Error;
    type Future: Future<Output = Result<Self::Response, Self::Error>>;

    fn poll_ready(&mut self, cx: &mut Context<'_>) -> Poll<Result<(), Self::Error>>;
    fn call(&mut self, req: Request) -> Self::Future;
}
```

Трейт `Service` отвечает за обработку запросов и возврат ответов, аналогично обработчикам (handlers) в Salvo.

### Трейт Layer

```rust
pub trait Layer<S> {
    type Service;
    fn layer(&self, inner: S) -> Self::Service;
}
```

Трейт `Layer` используется для обёртывания сервисов и добавления дополнительной функциональности, аналогично промежуточному ПО (middleware) в Salvo.

## Поддержка совместимости в Salvo

Salvo предоставляет два ключевых трейта для достижения совместимости с экосистемой Tower:

- **TowerLayerCompat**: Преобразует `Layer` из Tower в `Handler` Salvo, позволяя использовать его в качестве Hoop (промежуточного ПО).
- **TowerServiceCompat**: Преобразует `Service` из Tower в `Handler` Salvo.

Пример использования:
```rust
// Используем RateLimitLayer из Tower и преобразуем его в формат, совместимый с Salvo, с помощью метода compat()
let limit = RateLimitLayer::new(5, Duration::from_secs(30)).compat();
let router = Router::new().hoop(limit).get(hello);
```

_**Пример кода**_

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/with-tower/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/with-tower/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:6b353b93693e7c5ce97b584f3e8c62cf */}