# Panics in Anfragen abfangen

Catch Panic dient dazu, Abstürze abzufangen, die während der Verarbeitung von Anfragen im laufenden Betrieb auftreten. Detaillierte APIs finden Sie in der [Dokumentation](https://docs.rs/salvo_extra/latest/salvo_extra/catch_panic/index.html).

> **Hinweis**: Um `CatchPanic` zu verwenden, muss das Feature `catch-panic` in `Cargo.toml` aktiviert werden:
> ```toml
> salvo = { version = "xxx", features = ["catch-panic"] }
> ```

## Middleware-Einführung

`CatchPanic` ist eine Middleware zum Abfangen von Panics in Handlern. Wenn während der Anfrageverarbeitung ein Panic auftritt, fängt sie diesen ab und schreibt stattdessen einen 500 Internal Server Error in die Antwort, anstatt den gesamten Server abstürzen zu lassen.

**Wichtig**: Diese Middleware sollte als erste Middleware verwendet werden, um sicherzustellen, dass Panics in anderen Middlewares oder Handlern abgefangen werden.

## Grundlegende Verwendung

```rust
use salvo_core::prelude::*;
use salvo_extra::catch_panic::CatchPanic;

#[handler]
async fn hello() {
    panic!("panic error!");
}

#[tokio::main]
async fn main() {
    let router = Router::new().hoop(CatchPanic::new()).get(hello);
    let acceptor = TcpListener::new("0.0.0.0:5800").bind().await;
    Server::new(acceptor).serve(router).await;
}
```

## Vergleich mit anderen Frameworks – Konzepte schnell verstehen

### Axum

Ähnlich dem `catch_panic`-Middleware von `Tower` in Axum:

```rust
use axum::{
    Router,
    routing::get,
    http::StatusCode,
};
use tower::ServiceBuilder;
use tower_http::catch_panic::CatchPanicLayer;

async fn panic_handler() -> &'static str {
    panic!("panic error!");
}

#[tokio::main]
async fn main() {
    let app = Router::new()
        .route("/", get(panic_handler))
        .layer(
            ServiceBuilder::new()
                .layer(CatchPanicLayer::new())
        );
    
    axum::Server::bind(&"0.0.0.0:3000".parse().unwrap())
        .serve(app.into_make_service())
        .await
        .unwrap();
}
```

### Gin (Go)

Im Go-Framework Gin ähnelt die Recovery-Middleware:

```go
package main

import (
    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.Default() // Enthält standardmäßig die Recovery-Middleware
    
    r.GET("/", func(c *gin.Context) {
        panic("panic error!")
    })
    
    r.Run(":8080")
}
```

## Beispielcode

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/catch-panic/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/catch-panic/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* 本行由工具自动生成,原文哈希值:ad03110400c39a35184d54e9554276b5 */}