# Controlo de Origem Cruzada

CORS (Cross-Origin Resource Sharing) é um mecanismo que permite aos navegadores fazer pedidos a servidores de origem cruzada, superando assim as restrições impostas pela política de mesma origem do navegador.

## O que é a Política de Mesma Origem?

A política de mesma origem é uma funcionalidade de segurança dos navegadores que restringe como documentos ou scripts carregados de uma origem podem interagir com recursos de outra origem. "Mesma origem" refere-se a ter o mesmo protocolo, domínio e número de porta.

## Por que é Necessário o CORS?

O suporte a CORS é necessário quando uma aplicação frontend precisa aceder a APIs de uma origem diferente. Por exemplo:
- A aplicação frontend é implementada em `https://frontend.com`
- O serviço API é implementado em `https://api.backend.com`

Sem CORS, o navegador impedirá a aplicação frontend de aceder ao serviço API.

## Como Funciona o CORS

O CORS implementa o controlo de acesso de origem cruzada através de uma série de cabeçalhos HTTP:
- **Pedidos Simples**: Enviados diretamente, com o servidor a controlar se o acesso é permitido através dos cabeçalhos de resposta.
- **Pedidos de Pré-Voo (Preflight)**: O navegador envia primeiro um pedido OPTIONS para perguntar ao servidor se o acesso de origem cruzada é permitido, e só envia o pedido real após receber permissão.

Como o navegador envia pedidos de pré-voo com `Method::OPTIONS`, é necessário lidar com tais pedidos. O middleware CORS deve ser adicionado ao `Service`.

## Usando CORS no Salvo

O Salvo fornece middleware CORS integrado que pode ser facilmente configurado e utilizado. Eis um exemplo de código:

:::warning
Nota: O middleware `.hoop(cors)` é aplicado ao `Service`, não ao `Router`. Isto garante o tratamento automático dos pedidos de pré-voo OPTIONS.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:8698", "http://localhost:8698"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Configurar router backend com proteção CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Código de Exemplo**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Principais Opções de Configuração

O middleware CORS fornece várias opções de configuração:

- **Origens Permitidas**: Controla quais domínios podem aceder aos recursos.
- **Métodos Permitidos**: Especifica os métodos HTTP permitidos (GET, POST, etc.).
- **Cabeçalhos Permitidos**: Especifica os cabeçalhos de pedido permitidos.
- **Cabeçalhos Expostos**: Especifica quais cabeçalhos de resposta podem ser acedidos pelo cliente.
- **Permitir Credenciais**: Determina se os pedidos podem incluir credenciais como cookies.
- **Tempo de Cache de Pedidos de Pré-Voo**: A duração da cache para os resultados dos pedidos de pré-voo.

Ao configurar o CORS adequadamente, pode garantir tanto a segurança como a capacidade de satisfazer os requisitos de acesso de origem cruzada.
{/* Auto generated, origin file hash:06a4a7b1ce4049ea7d3c15924bdd7397 */}