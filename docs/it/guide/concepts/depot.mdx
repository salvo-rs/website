# Depot

import { Tab, Tabs } from '@rspress/core/theme';

[Depot](https://docs.rs/salvo_core/latest/salvo_core/struct.Depot.html) è utilizzato per memorizzare dati temporanei coinvolti in una singola richiesta. I middleware possono inserire i propri dati elaborati nel Depot, rendendoli disponibili per i programmi successivi.

Quando un server riceve una richiesta da un browser client, crea un'istanza di `Depot`. Questa istanza viene distrutta dopo che tutti i middleware e gli `Handler` hanno completato l'elaborazione della richiesta.

Ad esempio, possiamo impostare `current_user` in un middleware di autenticazione, quindi leggere le informazioni dell'utente corrente nei middleware successivi o negli `Handler`.

## Comprensione Rapida

`Depot` viene utilizzato per archiviare e condividere dati durante l'elaborazione di una richiesta. Implementa un contenitore di dati type-safe che supporta due modalità d'uso principali:

1. **Archiviazione Chiave-Valore**: accedi ai valori associati a chiavi stringa tramite i metodi `insert`/`get`
2. **Iniezione di Tipo**: memorizza e recupera valori basati sul tipo tramite i metodi `inject`/`obtain`

Come mostrato negli esempi, `Depot` è particolarmente utile per passare dati tra middleware e gestori. I middleware possono impostare valori nel `Depot` (come informazioni utente, stato di autenticazione), che i gestori successivi possono recuperare senza bisogno di ricalcoli o query ripetute. Il design di `Depot` garantisce coerenza e accessibilità dei dati lungo l'intera catena di elaborazione della richiesta, rendendolo uno strumento fondamentale per costruire applicazioni Web complesse.

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/use-depot/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/use-depot/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Impostare e Recuperare Dati tramite `insert` e `get`

Come mostrato sopra, puoi inserire `key` e `value` nel `Depot` utilizzando `insert`. Per valori di questo tipo, utilizza direttamente `get` per recuperarli.

```rust
depot.insert("a", "b");
assert_eq!(depot.get::<&str>("a").copied().unwrap(), "b")
```

Se la chiave non esiste, o se esiste ma il tipo non corrisponde, viene restituito `None`.

## Impostare e Recuperare Dati tramite `inject` e `obtain`

A volte, esistono dati che non richiedono una chiave specifica e per i quali esiste un'unica istanza di quel tipo. Puoi utilizzare `inject` per inserire i dati e `obtain` per recuperarli. Non è necessario fornire una chiave.

```rust
depot.inject(Config::new());
depot.obtain::<Config>();
```

# Panoramica dei Metodi della Struttura Depot

| Categoria | Metodo | Descrizione |
|------|------|------|
| **Creazione/Capacità** | `new()` | Crea un Depot vuoto |
| | `with_capacity(capacity)` | Crea un Depot con capacità specificata |
| | `capacity()` | Ottiene la capacità |
| | `inner()` | Ottiene un riferimento all'HashMap interno |
| **Iniezione/Ottenimento per Tipo** | `inject<V>(value)` | Inietta un valore in base al tipo |
| | `obtain<T>()` | Ottiene un riferimento al valore iniettato |
| | `obtain_mut<T>()` | Ottiene un riferimento mutabile al valore iniettato |
| | `contains<T>()` | Verifica se contiene un tipo specifico |
| | `scrape<T>()` | Rimuove e restituisce il valore iniettato |
| **Operazioni Chiave-Valore** | `insert(key, value)` | Inserisce una coppia chiave-valore |
| | `get<V>(key)` | Ottiene un riferimento al valore associato alla chiave |
| | `get_mut<V>(key)` | Ottiene un riferimento mutabile al valore associato alla chiave |
| | `contains_key(key)` | Verifica se contiene una chiave specifica |
| | `remove<V>(key)` | Rimuove la chiave e restituisce il valore |
| | `delete(key)` | Elimina la coppia chiave-valore |
{/* 本行由工具自动生成,原文哈希值:11bf72b48a504b8ce6ae390caf56080c */}