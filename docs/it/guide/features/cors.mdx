# Controllo Cross-Origin

CORS (Cross-Origin Resource Sharing, Condivisione Risorse tra Origini Diverse) è un meccanismo che consente ai browser di effettuare richieste a server di origini diverse, superando così le limitazioni imposte dalla politica della stessa origine (Same-Origin Policy).

## Cos'è la Politica della Stessa Origine?

La politica della stessa origine è una funzionalità di sicurezza del browser che limita come un documento o script caricato da un'origine possa interagire con risorse provenienti da un'altra origine. Per "stessa origine" si intende avere lo stesso protocollo, dominio e numero di porta.

## Perché è necessario CORS?

Quando un'applicazione frontend necessita di accedere ad API ospitate su un'origine diversa, è necessario il supporto CORS. Ad esempio:
- L'applicazione frontend è distribuita su `https://frontend.com`
- Il servizio API è distribuito su `https://api.backend.com`

Senza CORS, il browser impedirebbe all'applicazione frontend di accedere al servizio API.

## Come Funziona CORS

CORS implementa il controllo degli accessi cross-origin attraverso una serie di intestazioni HTTP:
- **Richieste Semplici**: Inviate direttamente, il server controlla se consentirle tramite intestazioni di risposta.
- **Richieste Preflight**: Il browser invia prima una richiesta OPTIONS per chiedere al server se consente l'accesso cross-origin. Solo dopo aver ricevuto il permesso, invia la richiesta effettiva.

Poiché il browser invia richieste preflight `Method::OPTIONS`, è necessario gestire questo tipo di richieste aggiungendo il middleware CORS al `Service`.

## Utilizzare CORS in Salvo

Salvo fornisce un middleware CORS integrato, facile da configurare e utilizzare. Ecco un esempio di codice:

:::warning
Nota: Il middleware `.hoop(cors)` viene applicato al `Service`, non al `Router`.
In questo modo le richieste preflight OPTIONS vengono gestite automaticamente.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:5800", "http://localhost:5800"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Configura il router backend con protezione CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Codice di Esempio**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Opzioni di Configurazione Principali

Il middleware CORS offre diverse opzioni di configurazione:

- **Origini Consentite**: Controlla quali domini possono accedere alle risorse.
- **Metodi Consentiti**: Specifica i metodi HTTP consentiti (GET, POST, ecc.).
- **Intestazioni Consentite**: Specifica le intestazioni di richiesta consentite.
- **Intestazioni Esposte**: Specifica quali intestazioni di risposta sono accessibili al client.
- **Credenziali Consentite**: Indica se le richieste possono includere credenziali come cookie.
- **Durata Cache Richieste Preflight**: Tempo di memorizzazione nella cache del risultato delle richieste preflight.

Configurando opportunamente CORS, è possibile garantire sia la sicurezza che la necessità di accesso cross-origin.
{/* Auto generated, origin file hash:cf229c3c39be32658130e3590ea819e7 */}