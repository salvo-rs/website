# Capturer les Panics dans les Requêtes

Catch Panic sert à intercepter les plantages qui surviennent lors du traitement des requêtes par l'application. Pour les API spécifiques, veuillez [consulter la documentation](https://docs.rs/salvo_extra/latest/salvo_extra/catch_panic/index.html).

> **Note** : Pour utiliser `CatchPanic`, il faut activer la fonctionnalité `catch-panic` dans `Cargo.toml` :
> ```toml
> salvo= { version = "xxx", features = ["catch-panic"] }
> ```

## Présentation du Middleware

`CatchPanic` est un middleware conçu pour capturer les panics dans les gestionnaires. Lorsqu'un panic se produit pendant le traitement d'une requête, il l'intercepte et écrit une réponse 500 Internal Server Error, évitant ainsi un crash complet du serveur.

**Important** : Ce middleware doit être utilisé en premier pour garantir qu'il capture les panics provenant d'autres middlewares ou gestionnaires.

## Utilisation de Base

```rust
use salvo_core::prelude::*;
use salvo_extra::catch_panic::CatchPanic;

#[handler]
async fn hello() {
    panic!("panic error!");
}

#[tokio::main]
async fn main() {
    let router = Router::new().hoop(CatchPanic::new()).get(hello);
    let acceptor = TcpListener::new("0.0.0.0:5800").bind().await;
    Server::new(acceptor).serve(router).await;
}
```

## Comparaison avec d'autres Frameworks pour une Compréhension Rapide

### Axum

Middleware `catch_panic` de `Tower` dans Axum :

```rust
use axum::{
    Router,
    routing::get,
    http::StatusCode,
};
use tower::ServiceBuilder;
use tower_http::catch_panic::CatchPanicLayer;

async fn panic_handler() -> &'static str {
    panic!("panic error!");
}

#[tokio::main]
async fn main() {
    let app = Router::new()
        .route("/", get(panic_handler))
        .layer(
            ServiceBuilder::new()
                .layer(CatchPanicLayer::new())
        );
    
    axum::Server::bind(&"0.0.0.0:3000".parse().unwrap())
        .serve(app.into_make_service())
        .await
        .unwrap();
}
```

### Gin (Go)

Dans le framework Gin en Go, un middleware similaire est Recovery :

```go
package main

import (
    "github.com/gin-gonic/gin"
)

func main() {
    r := gin.Default() // Inclut par défaut le middleware Recovery
    
    r.GET("/", func(c *gin.Context) {
        panic("panic error!")
    })
    
    r.Run(":8080")
}
```

## Exemple de Code

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/catch-panic/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/catch-panic/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:ad03110400c39a35184d54e9554276b5 */}