# Cross-Origin-Kontrolle

CORS (Cross-Origin Resource Sharing) ist ein Mechanismus, der es Browsern ermöglicht, Anfragen an serverübergreifende Server zu stellen und so die Beschränkungen der Browser-Same-Origin-Policy zu umgehen.

## Was ist die Same-Origin-Policy?

Die Same-Origin-Policy ist eine Sicherheitsfunktion von Browsern, die einschränkt, wie Dokumente oder Skripte von einem Ursprung mit Ressourcen eines anderen Ursprungs interagieren können. "Same Origin" bedeutet, dass Protokoll, Domain und Portnummer identisch sind.

## Warum wird CORS benötigt?

CORS-Unterstützung ist erforderlich, wenn eine Frontend-Anwendung auf APIs eines anderen Ursprungs zugreifen muss. Beispiel:
- Die Frontend-Anwendung ist unter `https://frontend.com` bereitgestellt
- Der API-Dienst ist unter `https://api.backend.com` bereitgestellt

Ohne CORS verhindert der Browser, dass die Frontend-Anwendung auf den API-Dienst zugreift.

## Wie CORS funktioniert

CORS implementiert die serverübergreifende Zugriffskontrolle durch eine Reihe von HTTP-Headern:
- **Einfache Anfragen**: Werden direkt gesendet, wobei der Server über Antwort-Header steuert, ob der Zugriff erlaubt ist.
- **Preflight-Anfragen**: Der Browser sendet zuerst eine OPTIONS-Anfrage, um den Server zu fragen, ob serverübergreifender Zugriff erlaubt ist, und sendet die eigentliche Anfrage erst nach Erhalt der Erlaubnis.

Da der Browser Preflight-Anfragen mit `Method::OPTIONS` sendet, ist es notwendig, solche Anfragen zu behandeln. Das CORS-Middleware muss zum `Service` hinzugefügt werden.

## Verwendung von CORS in Salvo

Salvo bietet ein integriertes CORS-Middleware, das einfach konfiguriert und verwendet werden kann. Hier ist ein Beispielcodeausschnitt:

:::warning
Hinweis: Das `.hoop(cors)`-Middleware wird auf den `Service` angewendet, nicht auf den `Router`. Dies stellt sicher, dass OPTIONS-Preflight-Anfragen automatisch behandelt werden.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:8698", "http://localhost:8698"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Backend-Router mit CORS-Schutz einrichten
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Beispielcode**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Hauptkonfigurationsoptionen

Das CORS-Middleware bietet verschiedene Konfigurationsoptionen:

- **Erlaubte Ursprünge**: Steuert, welche Domänen auf Ressourcen zugreifen können.
- **Erlaubte Methoden**: Gibt erlaubte HTTP-Methoden an (GET, POST, etc.).
- **Erlaubte Header**: Gibt erlaubte Anfrage-Header an.
- **Verfügbar gemachte Header**: Gibt an, welche Antwort-Header vom Client abgerufen werden können.
- **Anmeldedaten erlauben**: Bestimmt, ob Anfragen Anmeldedaten wie Cookies enthalten dürfen.
- **Preflight-Anfrage-Cache-Zeit**: Die Cache-Dauer für Preflight-Anfrageergebnisse.

Durch angemessene Konfiguration von CORS können Sie sowohl Sicherheit als auch die Fähigkeit gewährleisten, serverübergreifende Zugriffsanforderungen zu erfüllen.
{/* Auto generated, origin file hash:06a4a7b1ce4049ea7d3c15924bdd7397 */}