# Depot

import { Tab, Tabs } from '@rspress/core/theme';

Le [Depot](https://docs.rs/salvo_core/latest/salvo_core/struct.Depot.html) est utilisé pour stocker les données temporaires impliquées dans le traitement d'une requête. Les middlewares peuvent y placer les données qu'ils traitent, rendant celles-ci disponibles pour les programmes suivants.

Lorsqu'un serveur reçoit une requête d'un navigateur client, il crée une instance de `Depot`. Cette instance est détruite une fois que tous les middlewares et le `Handler` ont fini de traiter la requête.

Par exemple, un middleware d'authentification peut définir un `current_user` dans le `Depot`, que les middlewares suivants ou le `Handler` pourront ensuite lire pour obtenir les informations de l'utilisateur courant.

## Compréhension rapide

Le `Depot` sert à stocker et partager des données pendant le traitement d'une requête. Il implémente un conteneur de données typé de manière sûre, supportant deux modes d'utilisation principaux :

1.  **Stockage clé-valeur** : Accéder aux valeurs via les méthodes `insert`/`get` en utilisant des clés de type chaîne de caractères.
2.  **Injection par type** : Stocker et récupérer des valeurs via les méthodes `inject`/`obtain` en se basant sur leur type.

Comme le montre l'exemple, le `Depot` est particulièrement utile pour transmettre des données entre les middlewares et les gestionnaires (handlers). Un middleware peut définir une valeur dans le `Depot` (comme des informations utilisateur, un état d'authentification), et les gestionnaires suivants peuvent la récupérer sans avoir à la recalculer ou la re-requêter. La conception du `Depot` garantit la cohérence et l'accessibilité des données tout au long de la chaîne de traitement de la requête, en faisant un outil central pour construire des applications Web complexes.
<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/use-depot/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/use-depot/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Définir et récupérer des données via `insert` et `get`

Comme indiqué ci-dessus, vous pouvez insérer une paire `clé`-`valeur` dans le `Depot` en utilisant `insert`. Pour ce type de valeur, utilisez simplement `get` pour la récupérer.

```rust
depot.insert("a", "b");
assert_eq!(depot.get::<&str>("a").copied().unwrap(), "b")
```

Si la clé n'existe pas, ou si elle existe mais que le type ne correspond pas, la méthode retourne `None`.

## Définir et récupérer des données via `inject` et `obtain`

Parfois, certaines données n'ont pas besoin d'une clé spécifique et il n'existe qu'une seule instance de ce type. Vous pouvez utiliser `inject` pour insérer la donnée, puis `obtain` pour la récupérer. Ces méthodes ne nécessitent pas de fournir de clé.

```rust
depot.inject(Config::new());
depot.obtain::<Config>();
```

# Aperçu des méthodes de la structure Depot

| Catégorie | Méthode | Description |
|------|------|------|
| **Création/Capacité** | `new()` | Crée un Depot vide |
| | `with_capacity(capacity)` | Crée un Depot avec une capacité spécifiée |
| | `capacity()` | Obtient la capacité actuelle |
| | `inner()` | Obtient une référence au HashMap interne |
| **Injection/Récupération par type** | `inject<V>(value)` | Injecte une valeur en fonction de son type |
| | `obtain<T>()` | Obtient une référence à une valeur injectée par type |
| | `obtain_mut<T>()` | Obtient une référence mutable à une valeur injectée par type |
| | `contains<T>()` | Vérifie si une valeur d'un type spécifique est présente |
| | `scrape<T>()` | Retire et retourne une valeur injectée par type |
| **Opérations clé-valeur** | `insert(key, value)` | Insère une paire clé-valeur |
| | `get<V>(key)` | Obtient une référence à la valeur associée à une clé |
| | `get_mut<V>(key)` | Obtient une référence mutable à la valeur associée à une clé |
| | `contains_key(key)` | Vérifie si une clé spécifique est présente |
| | `remove<V>(key)` | Retire une clé et retourne sa valeur |
| | `delete(key)` | Supprime une paire clé-valeur |
{/* 本行由工具自动生成,原文哈希值:11bf72b48a504b8ce6ae390caf56080c */}