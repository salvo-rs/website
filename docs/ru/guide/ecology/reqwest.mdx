---
title: HTTP-клиент для Rust
---

# Reqwest: HTTP-клиент для Rust

[Reqwest](https://docs.rs/reqwest/latest/reqwest/) — это высокоуровневая библиотека HTTP-клиента, которая упрощает процесс обработки HTTP-запросов и предоставляет множество часто используемых функций:

- Поддержка как асинхронных, так и блокирующих API
- Обработка различных типов тел запросов: простой текст, JSON, формы с URL-кодированием, multipart-формы
- Настраиваемая политика перенаправлений
- Поддержка HTTP-прокси
- Шифрование TLS включено по умолчанию
- Управление cookie

## Основное использование

### Выполнение GET-запроса

Для одиночных запросов можно использовать удобный метод `get`:

```rust
let body = reqwest::get("https://www.rust-lang.org")
    .await?
    .text()
    .await?;

println!("body = {body:?}");
```

> Примечание: Если вы планируете выполнять несколько запросов, лучше создать `Client` и использовать его повторно, чтобы воспользоваться преимуществами пула соединений.

```rust
let client = reqwest::Client::new();
let res = client.get("https://www.rust-lang.org")
    .send()
    .await?;
```

### Выполнение POST-запроса

Тело запроса можно задать с помощью метода `body()`:

```rust
let client = reqwest::Client::new();
let res = client.post("http://httpbin.org/post")
    .body("the exact body that is sent")
    .send()
    .await?;
```

### Данные формы

Отправка данных формы — распространённая задача. Можно использовать любой тип, который можно сериализовать в данные формы:

```rust
// Это отправит POST-запрос с телом `foo=bar&baz=quux`
let params = [("foo", "bar"), ("baz", "quux")];
let client = reqwest::Client::new();
let res = client.post("http://httpbin.org/post")
    .form(&params)
    .send()
    .await?;
```

### JSON-данные

JSON-данные легко отправить с помощью метода `json` (требует включения функции `json`):

```rust
// Это отправит POST-запрос с телом `{"lang":"rust","body":"json"}`
let mut map = HashMap::new();
map.insert("lang", "rust");
map.insert("body", "json");

let client = reqwest::Client::new();
let res = client.post("http://httpbin.org/post")
    .json(&map)
    .send()
    .await?;
```

### Обработка ответа

Ответы можно обрабатывать различными способами:

```rust
let res = client.get("https://www.rust-lang.org").send().await?;

// Получить код состояния
let status = res.status();

// Получить заголовки ответа
let content_type = res.headers().get("content-type").unwrap();

// Прочитать тело ответа как текст
let body = res.text().await?;

// Или распарсить его как JSON
let json: serde_json::Value = res.json().await?;
```

## Расширенные возможности

### Политика перенаправлений

По умолчанию клиент автоматически обрабатывает HTTP-перенаправления, следуя до 10 переходам. Это поведение можно настроить с помощью `ClientBuilder`:

```rust
let custom_client = reqwest::Client::builder()
    .redirect(reqwest::redirect::Policy::none()) // Отключить перенаправления
    .build()?;
```

### Поддержка cookie

Автоматическое сохранение и отправку сессионных cookie можно включить через `ClientBuilder`:

```rust
let client = reqwest::Client::builder()
    .cookie_store(true)
    .build()?;
```

### Настройки прокси

Системные прокси включены по умолчанию, они ищут настройки HTTP- или HTTPS-прокси в переменных окружения:

- `HTTP_PROXY` или `http_proxy`: прокси для HTTP-соединений
- `HTTPS_PROXY` или `https_proxy`: прокси для HTTPS-соединений
- `ALL_PROXY` или `all_proxy`: прокси для обоих типов соединений

Также можно явно задать прокси через код:

```rust
let proxy = reqwest::Proxy::http("https://secure.example")?;
let client = reqwest::Client::builder()
    .proxy(proxy)
    .build()?;

// Или отключить прокси
let client = reqwest::Client::builder()
    .no_proxy()
    .build()?;
```

### Настройка TLS

По умолчанию клиент использует TLS для подключения к HTTPS-целям:

```rust
// Добавить дополнительные сертификаты сервера
let cert = reqwest::Certificate::from_pem(&cert_bytes)?;
let client = reqwest::Client::builder()
    .add_root_certificate(cert)
    .build()?;

// Настроить клиентские сертификаты
let identity = reqwest::Identity::from_pkcs12_der(&pkcs12_der, "password")?;
let client = reqwest::Client::builder()
    .identity(identity)
    .build()?;
```

### Настройки таймаутов

Можно настроить длительность таймаутов для запросов:

```rust
let client = reqwest::Client::builder()
    .timeout(std::time::Duration::from_secs(10))
    .build()?;
```

## Опциональные функции

Reqwest предоставляет различные опциональные функции, которые можно включать или отключать через Cargo features:

- `http2` (включено по умолчанию): поддержка HTTP/2
- `default-tls` (включено по умолчанию): предоставляет поддержку TLS для HTTPS
- `rustls-tls`: предоставляет функциональность TLS с использованием rustls
- `blocking`: предоставляет блокирующий клиентский API
- `json`: предоставляет функциональность сериализации и десериализации JSON
- `multipart`: предоставляет функциональность multipart-форм
- `cookies`: предоставляет поддержку сессий cookie
- `gzip`, `brotli`, `deflate`, `zstd`: поддержка различных методов декомпрессии тела ответа
- `socks`: предоставляет поддержку прокси SOCKS5

## Блокирующий API

Когда асинхронные операции не нужны, можно использовать блокирующий API (требует включения функции `blocking`):

```rust
let body = reqwest::blocking::get("https://www.rust-lang.org")?.text()?;

let client = reqwest::blocking::Client::new();
let res = client.post("http://httpbin.org/post")
    .json(&map)
    .send()?;
```
{/* Auto generated, origin file hash:4a628a145c22ad294babfcfaa801e8d8 */}