# Graceful Shutdown

Graceful Shutdown bedeutet, dass der Server beim Herunterfahren nicht sofort alle Verbindungen beendet, sondern zunächst keine neuen Anfragen mehr annimmt und gleichzeitig bereits akzeptierten Anfragen ausreichend Zeit zur Bearbeitung lässt, bevor der Dienst geschlossen wird. Diese Methode verhindert ein abruptes Abbrechen von Anfragen und verbessert die Benutzererfahrung sowie die Systemzuverlässigkeit.

Salvo bietet Unterstützung für Graceful Shutdown durch die `handle`-Methode des `Server`, um einen Server-Handle zu erhalten, und anschließend den Aufruf der `stop_graceful`-Methode. Nach dem Aufruf dieser Methode wird der Server:

- Keine neuen Verbindungsanfragen mehr annehmen
- Auf die Fertigstellung laufender Anfragen warten
- Nach einer optional angegebenen Timeout-Zeit verbleibende Verbindungen zwangsweise schließen

Hier ein einfaches Beispiel:

```rust
use salvo_core::prelude::*;

#[tokio::main]
async fn main() {
    let acceptor = TcpListener::new("127.0.0.1:5800").bind().await;
    let server = Server::new(acceptor);
    let handle = server.handle();

    // Server elegant herunterfahren
    tokio::spawn(async move {
        tokio::time::sleep(std::time::Duration::from_secs(60)).await;
        handle.stop_graceful(None);
    });
    server.serve(Router::new()).await;
}
```

Im obigen Beispiel:

- `server.handle()` erhält einen Handle des Servers, der zur Steuerung des Server-Lebenszyklus verwendet werden kann
- `handle.stop_graceful(None)` startet den Graceful-Shutdown-Prozess, wobei `None` bedeutet, dass kein Timeout gesetzt wird und auf die Fertigstellung aller Anfragen gewartet wird
- Um ein Timeout zu setzen, kann `Some(Duration)` übergeben werden. Nach Ablauf des Timeouts werden verbleibende Verbindungen zwangsweise geschlossen

Diese Methode eignet sich besonders für Anwendungen, die in Containerumgebungen oder Cloud-Plattformen bereitgestellt werden, sowie für Hot-Updates, um sicherzustellen, dass Anfragen nicht unerwartet unterbrochen werden.
{/* Auto generated, origin file hash:37a3d8a11c033b0d07dca20cf5f3b96b */}