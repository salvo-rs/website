# CORS-Kontrolle

CORS (Cross-Origin Resource Sharing, Cross-Origin Resource Sharing) ist ein Mechanismus, der es Browsern ermöglicht, Anfragen an serverübergreifende Server zu senden und so die Einschränkungen der Same-Origin-Policy des Browsers zu überwinden.

## Was ist die Same-Origin-Policy?

Die Same-Origin-Policy ist eine Sicherheitsfunktion des Browsers, die einschränkt, wie ein von einer Quelle geladenes Dokument oder Skript mit Ressourcen einer anderen Quelle interagieren kann. "Same-Origin" bezieht sich auf dasselbe Protokoll, denselben Domainnamen und denselben Port.

## Warum wird CORS benötigt?

Wenn eine Frontend-Anwendung auf APIs einer anderen Quelle zugreifen muss, ist CORS-Unterstützung erforderlich. Zum Beispiel:
- Frontend-Anwendung bereitgestellt unter `https://frontend.com`
- API-Dienst bereitgestellt unter `https://api.backend.com`

Ohne CORS würde der Browser den Zugriff der Frontend-Anwendung auf den API-Dienst blockieren.

## Funktionsweise von CORS

CORS implementiert die serverübergreifende Zugriffskontrolle über eine Reihe von HTTP-Headern:
- Einfache Anfragen: Werden direkt gesendet, der Server steuert über Antwortheader, ob sie erlaubt sind.
- Preflight-Anfragen: Der Browser sendet zuerst eine OPTIONS-Anfrage, um den Server nach der Erlaubnis für serverübergreifenden Zugriff zu fragen, und sendet erst nach Erhalt der Erlaubnis die eigentliche Anfrage.

Da der Browser eine Preflight-Anfrage mit `Method::OPTIONS` sendet, muss die Verarbeitung solcher Anfragen hinzugefügt werden. Das CORS-Middleware muss zum `Service` hinzugefügt werden.

## Verwendung von CORS in Salvo

Salvo bietet ein integriertes CORS-Middleware, das einfach konfiguriert und verwendet werden kann. Hier ist ein Beispielcode:

:::warning
Hinweis. Die .hoop(cors)-Middleware wirkt auf den `Service`, nicht auf den `Router`.
Dadurch werden OPTIONS-Preflight-Anfragen automatisch verarbeitet.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:5800", "http://localhost:5800"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Backend-Router mit CORS-Schutz einrichten
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Beispielcode**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Hauptkonfigurationsoptionen

Das CORS-Middleware bietet verschiedene Konfigurationsoptionen:

- **Erlaubte Ursprünge**: Steuert, welche Domänen auf Ressourcen zugreifen können.
- **Erlaubte Methoden**: Gibt die erlaubten HTTP-Methoden an (GET, POST usw.).
- **Erlaubte Header**: Gibt die erlaubten Anfrageheader an.
- **Verfügbar gemachte Header**: Gibt an, welche Antwortheader für den Client zugänglich sind.
- **Erlaubte Anmeldeinformationen**: Legt fest, ob Anfragen Anmeldeinformationen wie Cookies enthalten dürfen.
- **Preflight-Anfrage-Cache-Zeit**: Cache-Zeit für die Ergebnisse von Preflight-Anfragen.

Durch angemessene Konfiguration von CORS kann sowohl Sicherheit gewährleistet als auch der Bedarf an serverübergreifendem Zugriff erfüllt werden.
{/* 本行由工具自动生成,原文哈希值:cf229c3c39be32658130e3590ea819e7 */}