# CSRF-Schutz

## Was ist CSRF?

CSRF (Cross-Site Request Forgery, Website-übergreifende Anfragefälschung) ist eine Sicherheitslücke, bei der Angreifer authentifizierte Benutzer dazu verleiten, unbeabsichtigte Aktionen auszuführen, ohne ihr Wissen. Einfach ausgedrückt nutzt der Angreifer die angemeldete Identität des Benutzers, um bösartige Anfragen im Namen des Benutzers zu senden.

## Funktionsweise von CSRF-Angriffen

Ein typischer Angriff verläuft wie folgt:
1. Der Benutzer meldet sich auf der Zielwebsite A an und erhält ein Authentifizierungs-Cookie.
2. Der Benutzer besucht die bösartige Website B.
3. Code auf Website B sendet automatisch eine Anfrage an Website A und überträgt dabei das Cookie des Benutzers.
4. Website A kann nicht unterscheiden, ob es sich um eine bösartige Anfrage oder eine legitime Benutzeraktion handelt.

## Schutzstrategien

Salvo bietet ein CSRF-Middleware, um Ihre Anwendung vor solchen Angriffen zu schützen:

- Hinzufügen eines versteckten CSRF-Tokens in Formularen
- Überprüfung, ob Benutzeranfragen ein gültiges CSRF-Token enthalten
- Standardmäßige Validierung von POST-, PATCH-, DELETE- und PUT-Anfragen

## CSRF-Implementierung in Salvo

`Csrf` ist eine Struktur, die `Handler` implementiert und ein `skipper`-Feld enthält, um Anfragen festzulegen, die von der Validierung ausgenommen werden sollen. Standardmäßig werden `Method::POST`, `Method::PATCH`, `Method::DELETE` und `Method::PUT` validiert.

Salvo unterstützt zwei Methoden zur CSRF-Token-Speicherung:

1. **CookieStore**: Speichert das Token in einem Cookie und prüft, ob der `csrf-token` im Anfrage-Header oder Formular mit dem Cookie-Wert übereinstimmt.
2. **SessionStore**: Speichert das Token in der Session und erfordert die Verwendung zusammen mit Session-Middleware.

_**Beispielcode**_ (Cookie Store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Beispielcode**_ (Session Store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* 本行由工具自动生成,原文哈希值:2eb072bb663695f226b56a34f14cdbb0 */}