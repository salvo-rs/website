# Controllo Cross-Origin

CORS (Cross-Origin Resource Sharing) è un meccanismo che consente ai browser di effettuare richieste a server cross-origin, superando così le restrizioni imposte dalla politica della stessa origine (same-origin policy) del browser.

## Cos'è la Politica della Stessa Origine?

La politica della stessa origine è una funzionalità di sicurezza dei browser che limita come documenti o script caricati da un'origine possano interagire con risorse provenienti da un'altra origine. "Stessa origine" si riferisce all'avere lo stesso protocollo, dominio e numero di porta.

## Perché è Necessario il CORS?

Il supporto CORS è necessario quando un'applicazione frontend deve accedere ad API da un'origine diversa. Ad esempio:
- L'applicazione frontend è distribuita su `https://frontend.com`
- Il servizio API è distribuito su `https://api.backend.com`

Senza CORS, il browser impedirà all'applicazione frontend di accedere al servizio API.

## Come Funziona il CORS

Il CORS implementa il controllo di accesso cross-origin attraverso una serie di intestazioni HTTP:
- **Richieste Semplici**: Inviate direttamente, con il server che controlla se l'accesso è consentito tramite intestazioni di risposta.
- **Richieste Preflight**: Il browser invia prima una richiesta OPTIONS per chiedere al server se l'accesso cross-origin è consentito, e invia la richiesta effettiva solo dopo aver ricevuto il permesso.

Poiché il browser invia richieste preflight con `Method::OPTIONS`, è necessario gestire tali richieste. Il middleware CORS deve essere aggiunto al `Service`.

## Utilizzo del CORS in Salvo

Salvo fornisce un middleware CORS integrato che può essere facilmente configurato e utilizzato. Ecco un frammento di codice di esempio:

:::warning
Nota: Il middleware `.hoop(cors)` viene applicato al `Service`, non al `Router`. Ciò garantisce la gestione automatica delle richieste preflight OPTIONS.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:8698", "http://localhost:8698"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Configura il router backend con protezione CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Codice di Esempio**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Principali Opzioni di Configurazione

Il middleware CORS offre varie opzioni di configurazione:

- **Origini Consentite**: Controlla quali domini possono accedere alle risorse.
- **Metodi Consentiti**: Specifica i metodi HTTP consentiti (GET, POST, ecc.).
- **Intestazioni Consentite**: Specifica le intestazioni di richiesta consentite.
- **Intestazioni Esposte**: Specifica quali intestazioni di risposta possono essere accessibili dal client.
- **Consenti Credenziali**: Determina se le richieste possono includere credenziali come i cookie.
- **Tempo di Cache Richieste Preflight**: La durata della cache per i risultati delle richieste preflight.

Configurando opportunamente il CORS, è possibile garantire sia la sicurezza che la capacità di soddisfare i requisiti di accesso cross-origin.
{/* Auto generated, origin file hash:06a4a7b1ce4049ea7d3c15924bdd7397 */}