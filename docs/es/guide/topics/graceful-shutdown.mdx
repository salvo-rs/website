# Apagado elegante

El apagado elegante se refiere a que, al cerrar un servidor, no se terminen inmediatamente todas las conexiones, sino que primero se deje de aceptar nuevas solicitudes, permitiendo que las solicitudes ya aceptadas tengan tiempo suficiente para completar su procesamiento antes de cerrar el servicio. Este método evita que las solicitudes se interrumpan abruptamente, mejorando la experiencia del usuario y la confiabilidad del sistema.

Salvo proporciona soporte para el apagado elegante a través del método `handle` del `Server`, que obtiene un manejador del servidor, y luego se llama al método `stop_graceful` para implementarlo. Después de llamar a este método, el servidor:

- Deja de aceptar nuevas solicitudes de conexión
- Espera a que se completen las solicitudes existentes
- Cierra forzosamente las conexiones restantes después de un tiempo de espera especificado (si se proporciona)

Aquí hay un ejemplo simple:

```rust
use salvo_core::prelude::*;

#[tokio::main]
async fn main() {
    let acceptor = TcpListener::new("127.0.0.1:5800").bind().await;
    let server = Server::new(acceptor);
    let handle = server.handle();

    // Apagar el servidor de manera elegante
    tokio::spawn(async move {
        tokio::time::sleep(std::time::Duration::from_secs(60)).await;
        handle.stop_graceful(None);
    });
    server.serve(Router::new()).await;
}
```

En el ejemplo anterior:

- `server.handle()` obtiene un manejador del servidor, que puede usarse para controlar su ciclo de vida
- `handle.stop_graceful(None)` inicia el proceso de apagado elegante; `None` significa que no se establece un tiempo de espera, por lo que esperará indefinidamente a que se completen todas las solicitudes
- Si se desea establecer un tiempo de espera, se puede pasar `Some(Duration)`; después del tiempo de espera, las conexiones restantes se cerrarán forzosamente

Este método es especialmente útil para aplicaciones que se implementan en entornos de contenedores o plataformas en la nube, así como para garantizar que las solicitudes no se interrumpan accidentalmente durante actualizaciones en caliente.
{/* Auto generated, origin file hash:37a3d8a11c033b0d07dca20cf5f3b96b */}