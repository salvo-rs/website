# Tower Middleware Compatibility

import { Tab, Tabs } from '@rspress/core/theme';

Salvo provides compatibility support for the Tower ecosystem through the `tower-compat` feature. For specific APIs, please [refer to the documentation](https://docs.rs/salvo_extra/latest/salvo_extra/tower_compat/index.html).

## Core Concepts of Tower

Tower is a service abstraction library primarily based on two core traits:

### Service Trait

```rust
pub trait Service<Request> {
    type Response;
    type Error;
    type Future: Future<Output = Result<Self::Response, Self::Error>>;

    fn poll_ready(&mut self, cx: &mut Context<'_>) -> Poll<Result<(), Self::Error>>;
    fn call(&mut self, req: Request) -> Self::Future;
}
```

The `Service` trait is responsible for handling requests and returning responses, similar to Salvo's handlers.

### Layer Trait

```rust
pub trait Layer<S> {
    type Service;
    fn layer(&self, inner: S) -> Self::Service;
}
```

The `Layer` trait is used to wrap services and add additional functionality, similar to Salvo's middleware.

## Salvo Compatibility Support

Salvo provides two key traits to achieve compatibility with the Tower ecosystem:

- **TowerLayerCompat**: Converts Tower's `Layer` into Salvo's `Handler`, allowing it to be used as a Hoop (middleware).
- **TowerServiceCompat**: Converts Tower's `Service` into Salvo's `Handler`.

Usage Example:
```rust
// Use Tower's RateLimitLayer and convert it to a Salvo-compatible format via the compat() method
let limit = RateLimitLayer::new(5, Duration::from_secs(30)).compat();
let router = Router::new().hoop(limit).get(hello);
```

_**Example Code**_

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/with-tower/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/with-tower/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* 本行由工具自动生成,原文哈希值:e4430fa65292b4543e3cd6f2010c4932 */}