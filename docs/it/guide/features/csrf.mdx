# Difesa CSRF

## Cos'è il CSRF?

CSRF (Cross-Site Request Forgery, falsificazione di richieste cross-site) è una vulnerabilità di sicurezza informatica in cui un attaccante induce un utente autenticato a eseguire azioni non intenzionali senza la sua consapevolezza. In termini semplici, l'attaccante sfrutta l'identità già autenticata dell'utente per inviare richieste dannose a suo nome.

## Principio di attacco CSRF

Le fasi dell'attacco sono tipicamente le seguenti:
1. L'utente accede al sito web target A e ottiene un cookie di autenticazione
2. L'utente visita il sito web dannoso B
3. Il codice nel sito web B invia automaticamente una richiesta al sito A, includendo il cookie dell'utente
4. Il sito A non riesce a distinguere se si tratta di una richiesta dannosa o di un'azione legittima dell'utente

## Strategie di protezione

Salvo fornisce un middleware CSRF per proteggere la tua applicazione da questo tipo di attacchi:

- Aggiunge un token CSRF nascosto nei moduli
- Verifica che le richieste inviate dagli utenti contengano un token CSRF valido
- Per impostazione predefinita, verifica le richieste POST, PATCH, DELETE e PUT

## Implementazione CSRF in Salvo

`Csrf` è una struttura che implementa `Handler`, contenente internamente anche un campo `skipper` che consente di specificare quali richieste saltare durante la verifica. Per impostazione predefinita, verifica le richieste `Method::POST`, `Method::PATCH`, `Method::DELETE`, `Method::PUT`.

Salvo supporta due metodi di memorizzazione dei token CSRF:

1. **CookieStore**: memorizza il token in un cookie, verificando che il valore `csrf-token` nell'intestazione della richiesta o nel modulo corrisponda al valore del cookie
2. **SessionStore**: memorizza il token nella sessione, richiedendo l'uso congiunto con il middleware di sessione

_**Codice di esempio**_ (cookie store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Codice di esempio**_ (session store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:2eb072bb663695f226b56a34f14cdbb0 */}