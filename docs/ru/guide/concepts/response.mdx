# Ответ

В `Handler` структура [`Response`](https://docs.rs/salvo_core/latest/salvo_core/http/response/struct.Response.html) передаётся в качестве параметра:
* Структура `Response` инкапсулирует все компоненты HTTP-ответа, предоставляя комплексный API для построения и управления HTTP-ответами.
* Она поддерживает цепочечный (fluent) стиль (например, `res.status_code(200).body("Hello")`), что облегчает плавное построение ответов.
* Ключевые возможности включают:
    * Установку кодов состояния и заголовков
    * Управление телом ответа (поддержка строк, байтов, файлов и потоковых данных)
    * Работу с Cookies
    * Несколько методов рендеринга контента
* Эта структура использует шаблон изменяемой ссылки, возвращая ссылку на саму себя через `&mut self`, что позволяет обработчикам удобно строить и настраивать HTTP-ответы для удовлетворения различных требований веб-сервисов.

```rust
#[handler]
async fn hello_world(res: &mut Response) {
    res.render("Hello world!");
}
```

После того как сервер получает запрос от клиента, любой соответствующий `Handler` или промежуточное ПО (middleware) могут записывать данные в `Response`. В определённых сценариях, например, когда промежуточное ПО хочет предотвратить выполнение последующих промежуточных обработчиков и `Handler`, можно использовать `FlowCtrl`:

```rust
#[handler]
async fn hello_world(res: &mut Response, ctrl: &mut FlowCtrl) {
    ctrl.skip_rest();
    res.render("Hello world!");
}
```

## Запись содержимого

Запись данных в `Response` выполняется просто:

- Запись простых текстовых данных

    ```rust
    res.render("Hello world!");
    ```

- Запись сериализованных JSON-данных

    ```rust
    use serde::Serialize;
    use salvo::prelude::Json;

    #[derive(Serialize, Debug)]
    struct User {
        name: String,
    }
    let user = User{name: "jobs".to_string()};
    res.render(Json(user));
    ```

:::warning
Если метод `render` вызывается несколько раз для записи JSON-данных, эти данные не будут объединены в единый JSON-объект. Вместо этого они будут последовательно сконкатенированы как независимые текстовые фрагменты, что потенциально может привести к невалидному формату JSON. Если необходимо вернуть несколько элементов данных, их следует объединить в один объект перед сериализацией или обработать логику вручную.
:::

- Запись HTML

    ```rust
    res.render(Text::Html("<html><body>hello</body></html>"));
    ```

## Запись HTTP-ошибок

- Использование `render` позволяет записывать детальную информацию об ошибке в `Response`.

    ```rust
    use salvo::http::errors::*;
    res.render(StatusError::internal_server_error().brief("error when serialize object to json"))
    ```

- Если пользовательская информация об ошибке не требуется, можно напрямую вызвать `set_http_code`.

    ```rust
    use salvo::http::StatusCode;
    res.status_code(StatusCode::BAD_REQUEST);
    ```

## Перенаправление на другой URL
- Используя метод `render`, можно записать ответ с перенаправлением в `Response`, осуществляя переход на новый URL. При вызове `Redirect::found` устанавливается HTTP-код состояния 302 (Found), что указывает на временное перенаправление.
    ```rust
    use salvo::prelude::*;

    #[handler]
    async fn redirect(res: &mut Response) {
        res.render(Redirect::found("https://salvo.rs/"));
    }
    ```

## ResBody

Тип Body, возвращаемый Response, — это `ResBody`, который является перечислением (enum). В случае ошибки он устанавливается в `ResBody::Error`, содержащий информацию об ошибке для отложенной обработки ошибок. Примечательно, что `StatusError` не реализует `Writer`; такое проектирование позволяет вам настраивать его отображение в `Catcher`.

# Обзор методов структуры Response

| Категория | Метод | Описание |
|----------|--------|-------------|
| **Создание** | `new()` / `with_cookies()` | Создать новый ответ |
| **Код состояния** | `status_code()` | Установить код состояния |
| **Заголовки** | `headers()/headers_mut()` | Получить заголовки |
| | `set_headers()/add_header()` | Установить/Добавить заголовки |
| | `content_type()` | Получить тип контента |
| **Версия HTTP** | `version()/version_mut()` | Получить/Изменить версию HTTP |
| **Тело ответа** | `body()/body_mut()` | Установить/Получить тело ответа |
| | `replace_body()/take_body()` | Заменить/Извлечь тело ответа |
| | `write_body()` | Записать данные в тело ответа |
| | `stream()/channel()` | Потоковый ответ / Создать канал отправки |
| **Работа с Cookie** | `cookies()/cookie()` | Получить cookies / Получить конкретный cookie |
| | `add_cookie()/remove_cookie()` | Добавить/Удалить cookie |
| **Ответ с контентом** | `render()` | Отрендерить контент |
| | `stuff()` | Установить код состояния и отрендерить контент |
| | `send_file()` | Отправить файл |
| **Запрос состояния** | `is_stamped()` | Проверить, готов ли ответ к записи обратно |
{/* Auto generated, origin file hash:a24d0c508656d4d8ca4ecde0ef7d9534 */}