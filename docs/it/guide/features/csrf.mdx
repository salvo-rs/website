# Protezione CSRF

## Cos'è il CSRF?

CSRF (Cross-Site Request Forgery) è una vulnerabilità di sicurezza web in cui gli aggressori inducono utenti autenticati a eseguire azioni non intenzionali a loro insaputa. In termini semplici, gli attaccanti sfruttano lo stato di accesso di un utente per inviare richieste dannose a suo nome.

## Come funzionano gli attacchi CSRF

Il tipico processo di attacco comprende:
1. L'utente accede al sito web target A e ottiene un cookie di autenticazione.
2. L'utente visita un sito web dannoso B.
3. Il codice sul sito web dannoso B invia automaticamente una richiesta al sito A, trasportando il cookie dell'utente.
4. Il sito A non può distinguere se si tratta di una richiesta dannosa o di un'azione legittima dell'utente.

## Strategie di protezione

Salvo fornisce middleware CSRF per proteggere le tue applicazioni da tali attacchi:

- Aggiungi un token CSRF nascosto ai moduli.
- Verifica che le richieste inviate dagli utenti contengano un token CSRF valido.
- Per impostazione predefinita, convalida le richieste POST, PATCH, DELETE e PUT.

## Implementazione CSRF in Salvo

`Csrf` è una struct che implementa il tratto `Handler` e include un campo interno `skipper` per specificare le richieste che devono saltare la validazione. Per impostazione predefinita, convalida le richieste `Method::POST`, `Method::PATCH`, `Method::DELETE` e `Method::PUT`.

Salvo supporta due metodi di memorizzazione dei token CSRF:

1. **CookieStore**: Memorizza il token in un cookie e verifica se il `csrf-token` negli header della richiesta o nel modulo corrisponde al valore del cookie.
2. **SessionStore**: Memorizza il token nella sessione e richiede l'uso del middleware di sessione.

_**Codice di esempio**_ (cookie store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Codice di esempio**_ (session store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:281af9db9061b1bf9710319568d31c6d */}