# CSRF-Schutz

## Was ist CSRF?

CSRF (Cross-Site Request Forgery) ist eine Sicherheitslücke im Web, bei der Angreifer authentifizierte Nutzer dazu verleiten, unbeabsichtigt Aktionen auszuführen, ohne ihr Wissen. Einfach ausgedrückt nutzen Angreifer den angemeldeten Status eines Nutzers aus, um in dessen Namen bösartige Anfragen zu senden.

## Wie CSRF-Angriffe funktionieren

Der typische Angriffsablauf umfasst:
1. Der Nutzer meldet sich auf der Zielwebsite A an und erhält ein Authentifizierungs-Cookie.
2. Der Nutzer besucht eine schädliche Website B.
3. Code auf der schädlichen Website B sendet automatisch eine Anfrage an Website A und überträgt dabei das Cookie des Nutzers.
4. Website A kann nicht unterscheiden, ob es sich um eine bösartige Anfrage oder eine legitime Nutzeraktion handelt.

## Schutzstrategien

Salvo bietet CSRF-Middleware, um Ihre Anwendungen vor solchen Angriffen zu schützen:

- Fügen Sie Formularen ein verstecktes CSRF-Token hinzu.
- Überprüfen Sie, ob von Nutzern gesendete Anfragen ein gültiges CSRF-Token enthalten.
- Standardmäßig werden POST-, PATCH-, DELETE- und PUT-Anfragen validiert.

## CSRF-Implementierung in Salvo

`Csrf` ist eine Struktur, die das `Handler`-Trait implementiert und ein internes `skipper`-Feld enthält, um Anfragen anzugeben, die die Validierung überspringen sollen. Standardmäßig validiert sie `Method::POST`-, `Method::PATCH`-, `Method::DELETE`- und `Method::PUT`-Anfragen.

Salvo unterstützt zwei Methoden zur CSRF-Token-Speicherung:

1. **CookieStore**: Speichert das Token in einem Cookie und prüft, ob das `csrf-token` in den Anfrage-Headern oder im Formular mit dem Cookie-Wert übereinstimmt.
2. **SessionStore**: Speichert das Token in der Session und erfordert die Verwendung von Session-Middleware.

_**Beispielcode**_ (Cookie-Store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Beispielcode**_ (Session-Store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:281af9db9061b1bf9710319568d31c6d */}