# Защита от CSRF

## Что такое CSRF?

CSRF (Межсайтовая подделка запроса) — это уязвимость веб-безопасности, при которой злоумышленники обманом заставляют аутентифицированных пользователей выполнять непредусмотренные действия без их ведома. Проще говоря, злоумышленники используют статус пользователя, вошедшего в систему, для отправки вредоносных запросов от его имени.

## Как работают CSRF-атаки

Типичный процесс атаки включает:
1. Пользователь входит на целевой сайт A и получает аутентификационную cookie.
2. Пользователь посещает вредоносный сайт B.
3. Код на вредоносном сайте B автоматически отправляет запрос на сайт A, передавая cookie пользователя.
4. Сайт A не может определить, является ли этот запрос вредоносным или законным действием пользователя.

## Стратегии защиты

Salvo предоставляет CSRF-промежуточное ПО для защиты ваших приложений от таких атак:

- Добавление скрытого CSRF-токена в формы.
- Проверка того, что отправленные пользователем запросы содержат действительный CSRF-токен.
- По умолчанию проверяются запросы POST, PATCH, DELETE и PUT.

## Реализация CSRF в Salvo

`Csrf` — это структура, реализующая признак `Handler` и включающая внутреннее поле `skipper` для указания запросов, которые должны пропускать проверку. По умолчанию она проверяет запросы `Method::POST`, `Method::PATCH`, `Method::DELETE` и `Method::PUT`.

Salvo поддерживает два метода хранения CSRF-токенов:

1. **CookieStore**: Хранит токен в cookie и проверяет, соответствует ли `csrf-token` в заголовках запроса или форме значению cookie.
2. **SessionStore**: Хранит токен в сессии и требует использования промежуточного ПО для работы с сессиями.

_**Пример кода**_ (cookie store)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Пример кода**_ (session store)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:281af9db9061b1bf9710319568d31c6d */}