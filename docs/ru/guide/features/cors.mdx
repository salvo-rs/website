# Управление кросс-доменными запросами (CORS)

CORS (Cross-Origin Resource Sharing, обмен ресурсами между разными источниками) — это механизм, позволяющий браузерам выполнять запросы к серверам с других доменов, преодолевая ограничения политики одинакового происхождения.

## Что такое политика одинакового происхождения?

Политика одинакового происхождения (Same-Origin Policy) — это функция безопасности браузеров, которая ограничивает взаимодействие документов или скриптов, загруженных из одного источника, с ресурсами из другого источника. "Одинаковый источник" означает совпадение протокола, доменного имени и порта.

## Зачем нужен CORS?

Когда фронтенд-приложению нужно обращаться к API на другом домене, требуется поддержка CORS. Например:
- Фронтенд размещён на `https://frontend.com`
- API сервис работает на `https://api.backend.com`

Без CORS браузер заблокирует доступ фронтенда к API сервису.

## Как работает CORS

CORS использует набор HTTP-заголовков для управления кросс-доменными запросами:
- Простые запросы: отправляются напрямую, сервер указывает в ответе разрешён ли доступ
- Предварительные запросы (preflight): браузер сначала отправляет OPTIONS-запрос для проверки разрешений, и только после подтверждения отправляет основной запрос

Поскольку браузер отправляет предварительный OPTIONS-запрос, необходимо добавить обработку таких запросов, поместив CORS-мидлвар на уровень `Service`.

## Использование CORS в Salvo

Salvo предоставляет встроенный CORS-мидлвар с простой настройкой. Пример кода:

:::warning
Внимание. Мидлвар .hoop(cors) применяется к `Service`, а не к `Router`. Это автоматически обрабатывает предварительные OPTIONS-запросы.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:5800", "http://localhost:5800"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Настройка роутера с защитой CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Пример кода**_

import { Tab, Tabs } from 'rspress/theme';
import CorsCode from '../../../../codes_md/cors/src/main.mdx';
import CorsCargoCode from '../../../../codes_md/cors/Cargo.mdx';

<Tabs>
  <Tab label="main.rs">
    <CorsCode/>
  </Tab>
  <Tab label="Cargo.toml">
    <CorsCargoCode/>
  </Tab>
</Tabs>

## Основные параметры настройки

CORS-мидлвар предоставляет различные опции конфигурации:

- **Разрешённые источники**: контролирует, какие домены могут обращаться к ресурсам
- **Разрешённые методы**: указывает допустимые HTTP-методы (GET, POST и др.)
- **Разрешённые заголовки**: задаёт разрешённые заголовки запросов
- **Открытые заголовки**: определяет, какие заголовки ответа доступны клиенту
- **Разрешение учётных данных**: разрешает ли запросам включать cookies и другие учётные данные
- **Время кэширования предварительных запросов**: срок хранения результатов проверки preflight-запросов

Правильная настройка CORS обеспечивает безопасность при сохранении функциональности кросс-доменных запросов.
{/* 本行由工具自动生成,原文哈希值:0b191eacd5af64466fceaea928dec4d4 */}