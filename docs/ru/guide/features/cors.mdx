# Контроль междоменных запросов (CORS)

CORS (Cross-Origin Resource Sharing) — это механизм, позволяющий браузерам выполнять запросы к серверам с других источников, преодолевая ограничения, накладываемые политикой одинакового происхождения (Same-Origin Policy).

## Что такое политика одинакового происхождения?

Политика одинакового происхождения — это функция безопасности браузеров, ограничивающая взаимодействие документов или скриптов, загруженных из одного источника, с ресурсами из другого источника. «Одинаковое происхождение» подразумевает использование одинакового протокола, домена и номера порта.

## Зачем нужен CORS?

Поддержка CORS необходима, когда фронтенд-приложению требуется доступ к API с другого источника. Например:
- Фронтенд-приложение развернуто на `https://frontend.com`
- API-сервис развернут на `https://api.backend.com`

Без CORS браузер заблокирует доступ фронтенд-приложения к API-сервису.

## Как работает CORS

CORS реализует контроль междоменного доступа через набор HTTP-заголовков:
- **Простые запросы**: Отправляются напрямую, а сервер управляет разрешением доступа через заголовки ответа.
- **Предварительные запросы (Preflight)**: Браузер сначала отправляет запрос OPTIONS, чтобы запросить у сервера разрешение на междоменный доступ, и только после получения разрешения отправляет фактический запрос.

Поскольку браузер отправляет предварительные запросы с помощью `Method::OPTIONS`, необходимо обрабатывать такие запросы. Промежуточное ПО CORS должно быть добавлено в `Service`.

## Использование CORS в Salvo

Salvo предоставляет встроенное промежуточное ПО CORS, которое можно легко настроить и использовать. Пример кода:

:::warning
Важно: Промежуточное ПО `.hoop(cors)` применяется к `Service`, а не к `Router`. Это обеспечивает автоматическую обработку предварительных запросов OPTIONS.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:5800", "http://localhost:5800"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Настройка маршрутизатора бэкенда с защитой CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Пример кода**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Основные параметры конфигурации

Промежуточное ПО CORS предоставляет различные параметры настройки:

- **Разрешенные источники (Allowed Origins)**: Управляет тем, какие домены могут получать доступ к ресурсам.
- **Разрешенные методы (Allowed Methods)**: Определяет разрешенные HTTP-методы (GET, POST и т.д.).
- **Разрешенные заголовки (Allowed Headers)**: Определяет разрешенные заголовки запросов.
- **Открытые заголовки (Exposed Headers)**: Определяет, какие заголовки ответов могут быть доступны клиенту.
- **Разрешение учетных данных (Allow Credentials)**: Определяет, могут ли запросы включать учетные данные, такие как куки.
- **Время кэширования предварительных запросов (Preflight Request Cache Time)**: Длительность кэширования результатов предварительных запросов.

Правильная настройка CORS позволяет обеспечить как безопасность, так и возможность удовлетворения требований междоменного доступа.
{/* Auto generated, origin file hash:06a4a7b1ce4049ea7d3c15924bdd7397 */}