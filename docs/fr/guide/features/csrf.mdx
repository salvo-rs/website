# Protection CSRF

## Qu'est-ce que le CSRF ?

Le CSRF (Cross-Site Request Forgery) est une vulnérabilité de sécurité web où des attaquants incitent des utilisateurs authentifiés à effectuer des actions non désirées à leur insu. En termes simples, les attaquants exploitent le statut de connexion d'un utilisateur pour envoyer des requêtes malveillantes en son nom.

## Fonctionnement des attaques CSRF

Le processus d'attaque typique comprend :
1. L'utilisateur se connecte au site cible A et obtient un cookie d'authentification.
2. L'utilisateur visite un site malveillant B.
3. Le code du site malveillant B envoie automatiquement une requête au site A, en transmettant le cookie de l'utilisateur.
4. Le site A ne peut pas distinguer s'il s'agit d'une requête malveillante ou d'une action légitime de l'utilisateur.

## Stratégies de protection

Salvo fournit un middleware CSRF pour protéger vos applications contre ce type d'attaques :

- Ajouter un jeton CSRF caché dans les formulaires.
- Vérifier que les requêtes soumises par l'utilisateur contiennent un jeton CSRF valide.
- Par défaut, valider les requêtes POST, PATCH, DELETE et PUT.

## Implémentation du CSRF dans Salvo

`Csrf` est une structure qui implémente le trait `Handler` et inclut un champ interne `skipper` pour spécifier les requêtes qui doivent contourner la validation. Par défaut, il valide les requêtes `Method::POST`, `Method::PATCH`, `Method::DELETE` et `Method::PUT`.

Salvo prend en charge deux méthodes de stockage des jetons CSRF :

1. **CookieStore** : Stocke le jeton dans un cookie et vérifie si le `csrf-token` dans les en-têtes de requête ou le formulaire correspond à la valeur du cookie.
2. **SessionStore** : Stocke le jeton dans la session et nécessite l'utilisation d'un middleware de session.

_**Exemple de code**_ (stockage par cookie)

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-cookie-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-cookie-store/Cargo.toml"
  ```
  </Tab>
</Tabs>

_**Exemple de code**_ (stockage par session)

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/csrf-session-store/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/csrf-session-store/Cargo.toml"
  ```
  </Tab>
</Tabs>
{/* Auto generated, origin file hash:281af9db9061b1bf9710319568d31c6d */}