# Response

In `Handler`, [`Response`](https://docs.rs/salvo_core/latest/salvo_core/http/response/struct.Response.html) wird als Parameter übergeben:
* Die `Response`-Struktur kapselt alle Bestandteile einer HTTP-Antwort und bietet eine vollständige API zum Erstellen und Bearbeiten von HTTP-Antworten.
* Unterstützt einen verketteten Aufrufstil (z.B. `res.status_code(200).body("Hello")`), um Antworten flüssig aufzubauen.
* Kernfunktionen umfassen:
    * Setzen von Statuscodes und Anforderungsheadern
    * Bearbeiten des Antwortkörpers (Unterstützung für Zeichenketten, Bytes, Dateien und Streaming-Daten)
    * Verwalten von Cookies
    * Verschiedene Methoden zur Inhaltsdarstellung
* Diese Struktur verwendet ein veränderliches Referenzmuster, das durch `&mut self` einen Selbstverweis zurückgibt, sodass Handler bequem HTTP-Antworten erstellen und anpassen können, um verschiedenen Webdienst-Anforderungen gerecht zu werden.

```rust
#[handler]
async fn hello_world(res: &mut Response) {
    res.render("Hello world!");
}
```

Nachdem der Server eine Client-Anfrage empfangen hat, können alle passenden `Handler` und Middleware Daten in die `Response` schreiben. In bestimmten Fällen, z.B. wenn eine Middleware die Ausführung nachfolgender Middleware und `Handler` verhindern möchte, können Sie `FlowCtrl` verwenden:

```rust
#[handler]
async fn hello_world(res: &mut Response, ctrl: &mut FlowCtrl) {
    ctrl.skip_rest();
    res.render("Hello world!");
}
```

## Inhalte schreiben

Das Schreiben von Daten in `Response` ist sehr einfach:

- Reine Textdaten schreiben

    ```rust
    res.render("Hello world!");
    ```

- JSON-serialisierte Daten schreiben

    ```rust
    use serde::Serialize;
    use salvo::prelude::Json;

    #[derive(Serialize, Debug)]
    struct User {
        name: String,
    }
    let user = User{name: "jobs".to_string()};
    res.render(Json(user));
    ```

:::warning
Wenn die `render`-Methode mehrmals aufgerufen wird, um JSON-Daten zu schreiben, werden diese Daten nicht zu einem JSON-Objekt zusammengeführt, sondern als unabhängige Textfragmente nacheinander verkettet, was zu einem ungültigen JSON-Format führen kann. Wenn mehrere Daten zurückgegeben werden müssen, sollten sie zu einem Objekt kombiniert und dann auf einmal serialisiert werden, oder die Logik sollte selbst verarbeitet werden.
:::


- HTML schreiben
    
    ```rust
    res.render(Text::Html("<html><body>hello</body></html>"));
    ```

## HTTP-Fehler schreiben


- Mit `render` können detaillierte Fehlerinformationen in `Response` geschrieben werden.

    ```rust
    use salvo::http::errors::*;
    res.render(StatusError::internal_server_error().brief("Fehler beim Serialisieren des Objekts zu JSON"))
    ```

- Wenn Sie keine benutzerdefinierten Fehlermeldungen benötigen, können Sie direkt `set_http_code` aufrufen.

    ```rust
    use salvo::http::StatusCode;
    res.status_code(StatusCode::BAD_REQUEST);
    ```

## Umleitung auf andere URL
- Mit der `render`-Methode kann eine Umleitungsantwort in `Response` geschrieben werden, um zu einer neuen URL zu navigieren. Wenn Sie die Methode `Redirect::found` aufrufen, wird der HTTP-Statuscode auf 302 (Found) gesetzt, was eine temporäre Umleitung bedeutet. 
    ```rust
    use salvo::prelude::*;

    #[handler]
    async fn redirect(res: &mut Response) {
        res.render(Redirect::found("https://salvo.rs/"));
    }
    ```


## ResBody

Der von Response zurückgegebene Body-Typ ist `ResBody`, eine Enumeration, die bei einem Fehler auf `ResBody::Error` gesetzt wird. Hier sind Fehlerinformationen enthalten, um Fehler später zu verarbeiten. `StatusError` implementiert tatsächlich nicht `Writer`, sodass Sie in `Catcher` Ihre eigene Anzeigeart definieren können.



# Übersicht über die Methoden der Response-Struktur

| Kategorie | Methode | Beschreibung |
|------|------|------|
| **Erstellen** | `new()` / `with_cookies()` | Neue Antwort erstellen |
| **Statuscode** | `status_code()` | Statuscode setzen |
| **Anforderungsheader** | `headers()/headers_mut()` | Anforderungsheader abrufen |
| | `set_headers()/add_header()` | Header setzen/hinzufügen |
| | `content_type()` | Inhaltstyp abrufen |
| **HTTP-Version** | `version()/version_mut()` | HTTP-Version abrufen/ändern |
| **Antwortkörper** | `body()/body_mut()` | Antwortkörper setzen/abrufen |
| | `replace_body()/take_body()` | Antwortkörper ersetzen/extrahieren |
| | `write_body()` | Daten in Antwortkörper schreiben |
| | `stream()/channel()` | Streaming-Antwort/Sende-Kanal erstellen |
| **Cookie-Verarbeitung** | `cookies()/cookie()` | Cookies abrufen/bestimmtes Cookie |
| | `add_cookie()/remove_cookie()` | Cookie hinzufügen/entfernen |
| **Inhaltsantwort** | `render()` | Inhalt darstellen |
| | `stuff()` | Statuscode setzen und Inhalt darstellen |
| | `send_file()` | Datei senden |
| **Statusabfrage** | `is_stamped()` | Prüfen, ob Antwort zum Zurückschreiben bereit ist |
{/* Auto generated, origin file hash:44c6af44c98679e79e0828f210a61cd0 */}