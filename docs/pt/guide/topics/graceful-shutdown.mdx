# Encerramento Gracioso

O encerramento gracioso refere-se ao processo de desligamento do servidor onde, em vez de terminar imediatamente todas as conexões, o servidor primeiro para de aceitar novas solicitações e permite que as solicitações já aceitas tenham tempo suficiente para serem processadas antes de encerrar o serviço. Essa abordagem evita a interrupção abrupta de solicitações, melhorando a experiência do usuário e a confiabilidade do sistema.

O Salvo oferece suporte a encerramento gracioso através do método `handle` do `Server`, que obtém um manipulador do servidor, seguido pela chamada do método `stop_graceful`. Após chamar esse método, o servidor:

- Para de aceitar novas conexões
- Aguarda a conclusão do processamento das solicitações existentes
- Após um tempo limite especificado (se fornecido), força o encerramento das conexões restantes

Aqui está um exemplo simples:

```rust
use salvo_core::prelude::*;

#[tokio::main]
async fn main() {
    let acceptor = TcpListener::new("127.0.0.1:5800").bind().await;
    let server = Server::new(acceptor);
    let handle = server.handle();

    // Encerra o servidor graciosamente
    tokio::spawn(async move {
        tokio::time::sleep(std::time::Duration::from_secs(60)).await;
        handle.stop_graceful(None);
    });
    server.serve(Router::new()).await;
}
```

No exemplo acima:

- `server.handle()` obtém um manipulador do servidor, que pode ser usado para controlar seu ciclo de vida
- `handle.stop_graceful(None)` inicia o processo de encerramento gracioso, onde `None` significa que nenhum tempo limite é definido, aguardando indefinidamente até que todas as solicitações sejam processadas
- Para definir um tempo limite, pode-se passar `Some(Duration)`, após o qual as conexões restantes serão forçadamente encerradas

Essa abordagem é especialmente útil para aplicações implantadas em ambientes de contêineres ou plataformas de nuvem, bem como para garantir que as solicitações não sejam interrompidas inesperadamente durante atualizações em tempo real.
{/* Auto generated, origin file hash:37a3d8a11c033b0d07dca20cf5f3b96b */}