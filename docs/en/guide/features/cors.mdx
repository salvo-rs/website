# Cross-Origin Control

CORS (Cross-Origin Resource Sharing) is a mechanism that allows browsers to make requests to cross-origin servers, thereby overcoming the restrictions imposed by the browser's same-origin policy.

## What is the Same-Origin Policy?

The same-origin policy is a security feature of browsers that restricts how documents or scripts loaded from one origin can interact with resources from another origin. "Same origin" refers to having the same protocol, domain, and port number.

## Why is CORS Needed?

CORS support is required when a frontend application needs to access APIs from a different origin. For example:
- The frontend application is deployed at `https://frontend.com`
- The API service is deployed at `https://api.backend.com`

Without CORS, the browser will prevent the frontend application from accessing the API service.

## How CORS Works

CORS implements cross-origin access control through a series of HTTP headers:
- **Simple Requests**: Sent directly, with the server controlling whether access is allowed via response headers.
- **Preflight Requests**: The browser first sends an OPTIONS request to ask the server if cross-origin access is allowed, and only sends the actual request after receiving permission.

Since the browser sends preflight requests with `Method::OPTIONS`, it is necessary to handle such requests. The CORS middleware must be added to the `Service`.

## Using CORS in Salvo

Salvo provides built-in CORS middleware that can be easily configured and used. Here is an example code snippet:

:::warning
Note: The `.hoop(cors)` middleware is applied to the `Service`, not the `Router`. This ensures automatic handling of OPTIONS preflight requests.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:5800", "http://localhost:5800"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Set up backend router with CORS protection
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Example Code**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Main Configuration Options

The CORS middleware provides various configuration options:

- **Allowed Origins**: Controls which domains can access resources.
- **Allowed Methods**: Specifies allowed HTTP methods (GET, POST, etc.).
- **Allowed Headers**: Specifies allowed request headers.
- **Exposed Headers**: Specifies which response headers can be accessed by the client.
- **Allow Credentials**: Determines whether requests can include credentials such as cookies.
- **Preflight Request Cache Time**: The cache duration for preflight request results.

By configuring CORS appropriately, you can ensure both security and the ability to meet cross-origin access requirements.
{/* Auto generated, origin file hash:cf229c3c39be32658130e3590ea819e7 */}