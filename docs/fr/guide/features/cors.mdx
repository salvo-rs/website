# Contrôle d'Accès Inter-Origine

CORS (Cross-Origin Resource Sharing) est un mécanisme permettant aux navigateurs d'effectuer des requêtes vers des serveurs d'origine différente, surmontant ainsi les restrictions imposées par la politique de même origine des navigateurs.

## Qu'est-ce que la Politique de Même Origine ?

La politique de même origine est une fonctionnalité de sécurité des navigateurs qui limite la manière dont les documents ou scripts chargés depuis une origine peuvent interagir avec des ressources provenant d'une autre origine. "Même origine" signifie avoir le même protocole, domaine et numéro de port.

## Pourquoi CORS est-il Nécessaire ?

La prise en charge de CORS est requise lorsqu'une application frontend doit accéder à des API depuis une origine différente. Par exemple :
- L'application frontend est déployée sur `https://frontend.com`
- Le service API est déployé sur `https://api.backend.com`

Sans CORS, le navigateur empêchera l'application frontend d'accéder au service API.

## Fonctionnement de CORS

CORS implémente le contrôle d'accès inter-origine via une série d'en-têtes HTTP :
- **Requêtes Simples** : Envoyées directement, le serveur contrôlant l'autorisation d'accès via les en-têtes de réponse.
- **Requêtes Préliminaires** : Le navigateur envoie d'abord une requête OPTIONS pour demander au serveur si l'accès inter-origine est autorisé, et n'envoie la requête réelle qu'après avoir reçu la permission.

Puisque le navigateur envoie des requêtes préliminaires avec `Method::OPTIONS`, il est nécessaire de traiter ces requêtes. Le middleware CORS doit être ajouté au `Service`.

## Utilisation de CORS dans Salvo

Salvo fournit un middleware CORS intégré qui peut être facilement configuré et utilisé. Voici un exemple de code :

:::warning
Remarque : Le middleware `.hoop(cors)` est appliqué au `Service`, et non au `Router`. Cela garantit le traitement automatique des requêtes préliminaires OPTIONS.
```rust
let cors = Cors::new()
    .allow_origin(["http://127.0.0.1:5800", "http://localhost:5800"])
    .allow_methods(vec![Method::GET, Method::POST, Method::DELETE])
    .allow_headers("authorization")
    .into_handler();

// Configuration du routeur backend avec protection CORS
let router = Router::with_path("hello").post(hello);
let service = Service::new(router).hoop(cors);
```
:::

_**Exemple de Code**_

import { Tab, Tabs } from '@rspress/core/theme';

<Tabs>
  <Tab label="main.rs">
  ```rust file="<root>/codes/cors/src/main.rs"
  ```
  </Tab>
  <Tab label="Cargo.toml">
  ```toml file="<root>/codes/cors/Cargo.toml"
  ```
  </Tab>
</Tabs>

## Principales Options de Configuration

Le middleware CORS offre diverses options de configuration :

- **Origines Autorisées** : Contrôle quels domaines peuvent accéder aux ressources.
- **Méthodes Autorisées** : Spécifie les méthodes HTTP autorisées (GET, POST, etc.).
- **En-têtes Autorisés** : Spécifie les en-têtes de requête autorisés.
- **En-têtes Exposés** : Spécifie quels en-têtes de réponse peuvent être consultés par le client.
- **Autorisation des Identifiants** : Détermine si les requêtes peuvent inclure des identifiants tels que des cookies.
- **Durée de Cache des Requêtes Préliminaires** : Durée de mise en cache des résultats des requêtes préliminaires.

En configurant CORS de manière appropriée, vous pouvez garantir à la fois la sécurité et la capacité à répondre aux exigences d'accès inter-origine.
{/* Auto generated, origin file hash:06a4a7b1ce4049ea7d3c15924bdd7397 */}