---
title: Библиотеки даты и времени в Rust
---

# Chrono: Библиотека даты и времени для Rust

[Chrono](https://docs.rs/chrono/latest/chrono/) стремится предоставить все необходимые функции для корректных операций с датой и временем по григорианскому календарю:

- Тип `DateTime` по умолчанию учитывает часовые пояса, одновременно предоставляя отдельные типы, не зависящие от поясов.
- Операции, которые могут привести к недопустимым или неоднозначным датам и времени, возвращают `Option` или `MappedLocalTime`.
- Настраиваемый парсинг и форматирование с синтаксисом форматирования даты и времени, вдохновлённым strftime.
- Часовой пояс `Local` может работать с текущим часовым поясом операционной системы.
- Реализация типов и операций учитывает разумную эффективность.
- Чтобы ограничить размер бинарного файла, Chrono по умолчанию не включает данные о часовых поясах. Используйте сопутствующие крейты `Chrono-TZ` или `tzfile` для получения полной поддержки часовых поясов.

## Возможности

[Chrono](https://docs.rs/chrono/latest/chrono/) поддерживает различные среды выполнения и операционные системы и имеет несколько функций, которые можно включать или отключать.

### Функции по умолчанию:

- `alloc`: Включает функции, зависящие от выделения памяти (в основном форматирование строк).
- `std`: Включает функции, зависящие от стандартной библиотеки. Это надмножество `alloc`, добавляющее взаимодействие с типами и трейтами стандартной библиотеки.
- `clock`: Включает возможность чтения локального часового пояса (`Local`). Это надмножество `now`.
- `now`: Включает возможность чтения системного времени (`now`).
- `wasmbind`: Предоставляет интерфейс к JS Date API для целей wasm32.

### Опциональные функции:

- `serde`: Включает сериализацию/десериализацию через serde.
- `rkyv`: Устарело, используйте функции `rkyv-*`.
- `rkyv-16`, `rkyv-32`, `rkyv-64`: Включают сериализацию/десериализацию через rkyv, используя 16-битные, 32-битные или 64-битные целые числа соответственно.
- `rkyv-validation`: Включает поддержку валидации rkyv с использованием bytecheck.
- `arbitrary`: Создаёт произвольные экземпляры типов с использованием крейта Arbitrary.
- `unstable-locales`: Включает локализацию. Это добавляет различные методы с суффиксом `_localized`.

## Обзор

### Разница во времени / Длительность

Chrono предоставляет тип `TimeDelta` для представления величины временного интервала. Это "точная" длительность, выраженная в секундах и наносекундах, не представляющая "номинальные" компоненты, такие как дни или месяцы.

Тип `TimeDelta` ранее назывался `Duration` (доступен как псевдоним типа). Ключевое отличие от аналогичного `core::time::Duration` заключается в том, что он имеет знаковое значение, а не беззнаковое.

### Дата и время

Chrono предоставляет тип `DateTime` для представления даты и времени в часовом поясе.

`DateTime` учитывает часовой пояс и должен быть создан из объекта `TimeZone`, который определяет, как локальная дата преобразуется в дату UTC и обратно. Существует три известные реализации `TimeZone`:

- `Utc` определяет часовой пояс UTC. Он наиболее эффективен.
- `Local` определяет локальный часовой пояс системы.
- `FixedOffset` определяет произвольный фиксированный часовой пояс, например UTC+09:00 или UTC-10:30.

`DateTime` разных типов `TimeZone` различны и не могут смешиваться, но могут быть преобразованы друг в друга с помощью метода `DateTime::with_timezone`.

Вы можете получить текущую дату и время в часовом поясе UTC (`Utc::now()`) или в локальном часовом поясе (`Local::now()`).

```rust
use chrono::prelude::*;

let utc: DateTime<Utc> = Utc::now(); // например `2014-11-28T12:45:59.324310806Z`
let local: DateTime<Local> = Local::now(); // например `2014-11-28T21:45:59.324310806+09:00`
```

Кроме того, вы можете создавать собственные даты и время:

```rust
use chrono::offset::MappedLocalTime;
use chrono::prelude::*;

let dt = Utc.with_ymd_and_hms(2014, 7, 8, 9, 10, 11).unwrap(); // `2014-07-08T09:10:11Z`
```

### Форматирование и парсинг

Форматирование выполняется с помощью метода `format`, формат которого эквивалентен знакомому формату strftime.

Метод `to_string` по умолчанию и спецификатор `{:?}` также предоставляют разумное представление. Chrono также предоставляет методы `to_rfc2822` и `to_rfc3339` для распространённых форматов.

Chrono теперь также предоставляет возможность форматирования даты практически на любом языке без дополнительных C-библиотек. Эта функция доступна под возможностью `unstable-locales`:

```rust
use chrono::prelude::*;

let dt = Utc.with_ymd_and_hms(2014, 11, 28, 12, 0, 9).unwrap();
assert_eq!(dt.format("%Y-%m-%d %H:%M:%S").to_string(), "2014-11-28 12:00:09");
assert_eq!(dt.format_localized("%A %e %B %Y, %T", Locale::fr_BE).to_string(), 
           "vendredi 28 novembre 2014, 12:00:09");
```

Парсинг может быть выполнен двумя способами:

1. Стандартный трейт `FromStr` (и метод `parse` для строк) может быть использован для парсинга значений `DateTime<FixedOffset>`, `DateTime<Utc>` и `DateTime<Local>`.
2. `DateTime::parse_from_str` парсит дату и время со смещением и возвращает `DateTime<FixedOffset>`.

```rust
use chrono::prelude::*;

let dt = "2014-11-28T12:00:09Z".parse::<DateTime<Utc>>().unwrap();
let fixed_dt = DateTime::parse_from_str("2014-11-28 21:00:09 +09:00", "%Y-%m-%d %H:%M:%S %z").unwrap();
```

### Преобразование в/из меток времени EPOCH

Используйте `DateTime::from_timestamp(seconds, nanoseconds)` для создания `DateTime<Utc>` из UNIX-метки времени.

Используйте `DateTime.timestamp` для получения метки времени (в секундах) из `DateTime`. Кроме того, вы можете использовать `DateTime.timestamp_subsec_nanos` для получения дополнительных наносекунд.

```rust
use chrono::{DateTime, Utc};

// Создание datetime из эпохи:
let dt: DateTime<Utc> = DateTime::from_timestamp(1_500_000_000, 0).unwrap();
assert_eq!(dt.to_rfc2822(), "Fri, 14 Jul 2017 02:40:00 +0000");

// Получение значения эпохи из datetime:
let dt = DateTime::parse_from_rfc2822("Fri, 14 Jul 2017 02:40:00 +0000").unwrap();
assert_eq!(dt.timestamp(), 1_500_000_000);
```

## Ограничения

- Поддерживается только григорианский календарь с прямой экстраполяцией (т.е. расширен для поддержки более ранних дат).
- Типы дат ограничены примерно 262 000 лет до/после нашей эры.
- Типы времени ограничены точностью до наносекунд.
- Високосные секунды могут быть представлены, но Chrono не полностью их поддерживает.
{/* 本行由工具自动生成,原文哈希值:67733bfd2ba618b44f19c1449b096c42 */}